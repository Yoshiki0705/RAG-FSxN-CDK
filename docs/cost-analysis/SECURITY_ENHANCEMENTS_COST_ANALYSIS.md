# セキュリティ強化機能のコスト分析

**作成日**: 2025年11月10日  
**対象機能**: FSx Backup無効化、Cognito VPC Private接続

## エグゼクティブサマリー

本ドキュメントでは、権限認識型RAGシステムのセキュリティ強化機能に関するコスト分析を提供します。

### 主要な結論

| 項目 | 月額コスト | 年額コスト | 備考 |
|------|-----------|-----------|------|
| **FSx Backup無効化による削減** | -$73.00 | -$876.00 | 1TB FSxの場合 |
| **VPC Endpoint追加コスト** | +$7.30 | +$87.60 | オプション機能 |
| **正味コスト削減効果** | -$65.70 | -$788.40 | Public接続モード |
| **正味コスト削減効果（Private）** | -$65.70 | -$788.40 | Private接続モード |

## 1. FSx for ONTAP Backup無効化によるコスト削減

### 1.1 バックアップストレージコスト

**前提条件**:
- FSx for ONTAP容量: 1TB (1,024 GB)
- バックアップ保持期間: 7日（デフォルト）
- 日次変更率: 5%（一般的な想定）
- リージョン: ap-northeast-1（東京）

**計算式**:
```
初回フルバックアップ: 1,024 GB
日次増分バックアップ: 1,024 GB × 5% = 51.2 GB/日
7日間の累積: 1,024 GB + (51.2 GB × 6日) = 1,331.2 GB

バックアップストレージコスト: 1,331.2 GB × $0.055/GB/月 = $73.22/月
```

### 1.2 年間コスト削減効果

| 項目 | 月額 | 年額 |
|------|------|------|
| バックアップストレージ | $73.22 | $878.64 |
| **削減効果** | **-$73.22** | **-$878.64** |

### 1.3 FSx容量別コスト削減効果

| FSx容量 | 月額削減 | 年額削減 |
|---------|---------|---------|
| 512 GB | -$36.61 | -$439.32 |
| 1 TB | -$73.22 | -$878.64 |
| 2 TB | -$146.44 | -$1,757.28 |
| 5 TB | -$366.10 | -$4,393.20 |
| 10 TB | -$732.20 | -$8,786.40 |

### 1.4 代替バックアップ戦略のコスト

FSx自動バックアップを無効化した場合、以下の代替戦略を検討できます：

#### オプション1: AWS Backup（推奨）

```
AWS Backupストレージコスト: $0.05/GB/月（コールドストレージ）
1TB FSxの場合: 1,331.2 GB × $0.05 = $66.56/月

削減効果: $73.22 - $66.56 = $6.66/月（9%削減）
```

#### オプション2: S3 Glacier Deep Archive

```
S3 Glacier Deep Archiveコスト: $0.002/GB/月
1TB FSxの場合: 1,331.2 GB × $0.002 = $2.66/月

削減効果: $73.22 - $2.66 = $70.56/月（96%削減）
```

#### オプション3: バックアップなし（開発環境のみ）

```
削減効果: $73.22/月（100%削減）

注意: 本番環境では推奨されません
```

## 2. Cognito VPC Private接続の追加コスト

### 2.1 VPC Endpointコスト

**前提条件**:
- リージョン: ap-northeast-1（東京）
- VPC Endpoint タイプ: Interface Endpoint
- アベイラビリティゾーン数: 2（推奨）

**計算式**:
```
VPC Endpoint時間料金: $0.01/時間/AZ
月額（2 AZ）: $0.01 × 24時間 × 30日 × 2 AZ = $14.40/月

データ処理料金: $0.01/GB
月間データ転送量（想定）: 100 GB
データ処理コスト: 100 GB × $0.01 = $1.00/月

合計: $14.40 + $1.00 = $15.40/月
```

### 2.2 年間追加コスト

| 項目 | 月額 | 年額 |
|------|------|------|
| VPC Endpoint時間料金 | $14.40 | $172.80 |
| データ処理料金 | $1.00 | $12.00 |
| **合計追加コスト** | **$15.40** | **$184.80** |

### 2.3 データ転送量別コスト

| 月間データ転送量 | 月額追加コスト | 年額追加コスト |
|----------------|--------------|--------------|
| 50 GB | $14.90 | $178.80 |
| 100 GB | $15.40 | $184.80 |
| 500 GB | $19.40 | $232.80 |
| 1 TB | $24.40 | $292.80 |
| 5 TB | $64.40 | $772.80 |

### 2.4 アベイラビリティゾーン数別コスト

| AZ数 | 月額時間料金 | 年額時間料金 | 可用性 |
|------|------------|------------|--------|
| 1 AZ | $7.20 | $86.40 | 低 |
| 2 AZ（推奨） | $14.40 | $172.80 | 中 |
| 3 AZ | $21.60 | $259.20 | 高 |

## 3. 構成パターン別コスト比較

### 3.1 パターン1: Public接続モード（デフォルト）

**構成**:
- FSx Backup: 無効
- Cognito接続: Public（インターネット経由）

**月額コスト**:
```
FSx削減: -$73.22
VPC Endpoint追加: $0.00
正味削減: -$73.22/月
```

**年額コスト**: -$878.64

**推奨用途**:
- 開発環境
- ステージング環境
- コスト最適化優先の本番環境

### 3.2 パターン2: Private接続モード（セキュリティ優先）

**構成**:
- FSx Backup: 無効
- Cognito接続: Private（VPC Endpoint経由）

**月額コスト**:
```
FSx削減: -$73.22
VPC Endpoint追加: +$15.40
正味削減: -$57.82/月
```

**年額コスト**: -$693.84

**推奨用途**:
- セキュリティ要件が厳しい本番環境
- 金融・医療業界
- コンプライアンス要件がある環境

### 3.3 パターン3: FSx Backup有効 + Public接続

**構成**:
- FSx Backup: 有効（7日保持）
- Cognito接続: Public（インターネット経由）

**月額コスト**:
```
FSx削減: $0.00
VPC Endpoint追加: $0.00
正味削減: $0.00/月（ベースライン）
```

**年額コスト**: $0.00

**推奨用途**:
- 既存システムとの互換性維持
- バックアップ要件が厳しい環境

### 3.4 パターン4: FSx Backup有効 + Private接続

**構成**:
- FSx Backup: 有効（7日保持）
- Cognito接続: Private（VPC Endpoint経由）

**月額コスト**:
```
FSx削減: $0.00
VPC Endpoint追加: +$15.40
正味増加: +$15.40/月
```

**年額コスト**: +$184.80

**推奨用途**:
- 最高レベルのセキュリティとデータ保護が必要な環境
- 規制産業（金融、医療、政府）

## 4. コスト最適化の推奨事項

### 4.1 環境別推奨構成

| 環境 | FSx Backup | Cognito接続 | 月額コスト | 理由 |
|------|-----------|------------|-----------|------|
| 開発 | 無効 | Public | -$73.22 | コスト最適化優先 |
| ステージング | 無効 | Public | -$73.22 | 本番環境のテスト |
| 本番（標準） | 無効 | Public | -$73.22 | バランス重視 |
| 本番（高セキュリティ） | 無効 | Private | -$57.82 | セキュリティ優先 |
| 本番（最高セキュリティ） | 有効 | Private | +$15.40 | データ保護最優先 |

### 4.2 段階的導入戦略

**Phase 1: FSx Backup無効化（即座実施可能）**
- 月額削減: -$73.22
- リスク: 低
- 実装時間: 1時間

**Phase 2: 代替バックアップ戦略導入（推奨）**
- AWS Backup導入: +$66.56/月
- 正味削減: -$6.66/月
- リスク: 低
- 実装時間: 4時間

**Phase 3: Cognito Private接続（オプション）**
- 追加コスト: +$15.40/月
- リスク: 中
- 実装時間: 8時間

### 4.3 コスト削減のベストプラクティス

1. **FSx容量の最適化**
   - 定期的な容量レビュー
   - 不要なデータの削除
   - 重複排除の活用

2. **VPC Endpoint使用量の最適化**
   - データ転送量の監視
   - 不要なトラフィックの削減
   - キャッシュ戦略の導入

3. **環境別設定の最適化**
   - 開発環境: Public接続、Backup無効
   - 本番環境: 要件に応じて選択

## 5. ROI（投資対効果）分析

### 5.1 Public接続モード

**初期投資**: $0（設定変更のみ）
**年間削減**: $878.64
**ROI**: 無限大（投資ゼロ）
**回収期間**: 即座

### 5.2 Private接続モード

**初期投資**: $0（設定変更のみ）
**年間削減**: $693.84
**ROI**: 無限大（投資ゼロ）
**回収期間**: 即座

### 5.3 代替バックアップ戦略（AWS Backup）

**初期投資**: $0（設定変更のみ）
**年間削減**: $79.92
**ROI**: 無限大（投資ゼロ）
**回収期間**: 即座

## 6. コスト監視とアラート

### 6.1 推奨CloudWatch Metricsダッシュボード

```typescript
// VPC Endpointコスト監視
const vpcEndpointMetrics = [
  'BytesProcessed',
  'PacketsProcessed',
  'ActiveConnections',
];

// FSxストレージ監視
const fsxMetrics = [
  'StorageCapacity',
  'StorageUsed',
  'DataReadBytes',
  'DataWriteBytes',
];
```

### 6.2 推奨コストアラート

| アラート | 閾値 | アクション |
|---------|------|----------|
| VPC Endpointデータ転送 | 500 GB/月 | レビュー |
| FSxストレージ使用率 | 80% | 容量拡張検討 |
| 月額コスト増加 | 20%増 | 原因調査 |

## 7. まとめ

### 7.1 主要な結論

1. **FSx Backup無効化は大きなコスト削減効果**
   - 1TB FSxで月額$73.22削減
   - 年間$878.64削減

2. **Cognito Private接続は適度な追加コスト**
   - 月額$15.40追加
   - セキュリティ要件に応じて選択

3. **正味コスト削減効果は大きい**
   - Public接続: 月額$73.22削減
   - Private接続: 月額$57.82削減

### 7.2 推奨アクション

1. **即座実施**: FSx Backup無効化（全環境）
2. **検討**: 代替バックアップ戦略導入（本番環境）
3. **オプション**: Cognito Private接続（高セキュリティ環境）

### 7.3 次のステップ

1. 環境別コスト削減目標の設定
2. 段階的導入計画の策定
3. コスト監視ダッシュボードの構築
4. 四半期ごとのコストレビュー実施

---

**ドキュメントバージョン**: 1.0  
**最終更新日**: 2025年11月10日  
**レビュー担当**: インフラストラクチャチーム
