"use strict";
/**
 * WebAppスタック使用例とベストプラクティス
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ComprehensiveWebAppStackExample = exports.WebAppStackBestPractices = void 0;
exports.createDevelopmentWebAppStack = createDevelopmentWebAppStack;
exports.createEnvironmentSpecificWebAppStack = createEnvironmentSpecificWebAppStack;
exports.createStandardWebAppStack = createStandardWebAppStack;
exports.createSecureWebAppStack = createSecureWebAppStack;
exports.createHighAvailabilityWebAppStack = createHighAvailabilityWebAppStack;
// 改善版インポート
const webapp_stack_improved_1 = require("./webapp-stack-improved");
// 戦略パターンインポート
const webapp_stack_strategies_1 = require("./webapp-stack-strategies");
// テンプレートメソッドインポート
const webapp_stack_template_1 = require("./webapp-stack-template");
/**
 * 使用例1: Builder Patternを使用した開発環境スタック
 */
function createDevelopmentWebAppStack(scope, dependencies) {
    const config = new webapp_stack_improved_1.WebAppStackConfigBuilder()
        .setBasicConfig('permission-aware-rag', 'dev')
        .setCognitoConfig(webapp_stack_improved_1.CognitoConfigFactory.createDefaultConfig('permission-aware-rag', 'dev'))
        .setDefaultConfigs()
        .build();
    return new webapp_stack_improved_1.WebAppStack(scope, 'DevWebAppStack', {
        config,
        ...dependencies,
    });
}
/**
 * 使用例2: Strategy Patternを使用した環境別スタック
 */
function createEnvironmentSpecificWebAppStack(scope, environment, dependencies) {
    const configContext = new webapp_stack_strategies_1.WebAppConfigContext(environment);
    const baseConfig = configContext.createConfig('permission-aware-rag', environment);
    const config = new webapp_stack_improved_1.WebAppStackConfigBuilder()
        .setBasicConfig(baseConfig.projectName, baseConfig.environment)
        .setCognitoConfig(baseConfig.cognitoConfig)
        .setLambdaConfig(baseConfig.lambdaConfig)
        .setOutputConfig(baseConfig.outputConfig)
        .build();
    return new webapp_stack_improved_1.WebAppStack(scope, `${environment}WebAppStack`, {
        config,
        ...dependencies,
    });
}
/**
 * 使用例3: Template Method Patternを使用した標準スタック
 */
function createStandardWebAppStack(scope, environment, dependencies) {
    const strategy = webapp_stack_strategies_1.WebAppConfigStrategyFactory.createStrategy(environment);
    const config = strategy.createFullConfig('permission-aware-rag', environment);
    return new webapp_stack_template_1.StandardWebAppStack(scope, `StandardWebAppStack-${environment}`, {
        ...config,
        // ApiConfigは別途設定が必要
        apiConfig: {}, // 実際の実装では適切なApiConfigを設定
    }, dependencies);
}
/**
 * 使用例4: セキュリティ強化スタック
 */
function createSecureWebAppStack(scope, dependencies) {
    const strategy = webapp_stack_strategies_1.WebAppConfigStrategyFactory.createStrategy('production');
    const config = strategy.createFullConfig('permission-aware-rag', 'prod');
    return new webapp_stack_template_1.SecureWebAppStack(scope, 'SecureWebAppStack', {
        ...config,
        apiConfig: {}, // 実際の実装では適切なApiConfigを設定
    }, dependencies);
}
/**
 * 使用例5: 高可用性スタック
 */
function createHighAvailabilityWebAppStack(scope, dependencies) {
    const strategy = webapp_stack_strategies_1.WebAppConfigStrategyFactory.createStrategy('enterprise');
    const config = strategy.createFullConfig('permission-aware-rag', 'enterprise');
    return new webapp_stack_template_1.HighAvailabilityWebAppStack(scope, 'HAWebAppStack', {
        ...config,
        apiConfig: {}, // 実際の実装では適切なApiConfigを設定
    }, dependencies);
}
/**
 * ベストプラクティス例: 設定の検証と最適化
 */
class WebAppStackBestPractices {
    /**
     * 環境別設定の検証
     */
    static validateEnvironmentConfig(environment) {
        const supportedEnvironments = webapp_stack_strategies_1.WebAppConfigStrategyFactory.getSupportedEnvironments();
        return supportedEnvironments.includes(environment.toLowerCase());
    }
    /**
     * セキュリティ設定の推奨事項チェック
     */
    static checkSecurityRecommendations(environment) {
        const recommendations = [];
        const strategy = webapp_stack_strategies_1.WebAppConfigStrategyFactory.createStrategy(environment);
        const config = strategy.createFullConfig('test', environment);
        // パスワードポリシーチェック
        const passwordPolicy = config.cognitoConfig.userPool.passwordPolicy;
        if (passwordPolicy.minLength < 8) {
            recommendations.push('パスワード最小長を8文字以上に設定することを推奨します');
        }
        if (!passwordPolicy.requireSymbols && environment === 'prod') {
            recommendations.push('本番環境では記号を必須にすることを推奨します');
        }
        // セルフサインアップチェック
        if (config.cognitoConfig.userPool.selfSignUpEnabled && environment === 'prod') {
            recommendations.push('本番環境ではセルフサインアップを無効にすることを推奨します');
        }
        // 未認証アクセスチェック
        if (config.cognitoConfig.identityPool.allowUnauthenticatedIdentities) {
            recommendations.push('未認証アクセスを無効にすることを推奨します');
        }
        return recommendations;
    }
    /**
     * パフォーマンス最適化の推奨事項
     */
    static getPerformanceRecommendations(environment) {
        const recommendations = [];
        if (environment === 'prod') {
            recommendations.push('本番環境ではVPC設定を有効にすることを推奨します');
            recommendations.push('CloudFrontキャッシュ設定を最適化することを推奨します');
            recommendations.push('Lambda関数のメモリサイズを調整することを推奨します');
        }
        return recommendations;
    }
    /**
     * コスト最適化の推奨事項
     */
    static getCostOptimizationRecommendations(environment) {
        const recommendations = [];
        if (environment === 'dev') {
            recommendations.push('開発環境では不要な出力を無効にしてコストを削減できます');
            recommendations.push('開発環境ではリソースの自動削除を有効にできます');
        }
        return recommendations;
    }
}
exports.WebAppStackBestPractices = WebAppStackBestPractices;
/**
 * 統合使用例: 全ての改善パターンを組み合わせた例
 */
class ComprehensiveWebAppStackExample {
    static create(scope, projectName, environment, dependencies) {
        // 1. 環境検証
        if (!WebAppStackBestPractices.validateEnvironmentConfig(environment)) {
            throw new Error(`サポートされていない環境: ${environment}`);
        }
        // 2. セキュリティ推奨事項の確認
        const securityRecommendations = WebAppStackBestPractices.checkSecurityRecommendations(environment);
        if (securityRecommendations.length > 0) {
            console.warn('セキュリティ推奨事項:', securityRecommendations);
        }
        // 3. Strategy Patternで環境別設定を取得
        const configContext = new webapp_stack_strategies_1.WebAppConfigContext(environment);
        const baseConfig = configContext.createConfig(projectName, environment);
        // 4. Builder Patternで設定を構築
        const config = new webapp_stack_improved_1.WebAppStackConfigBuilder()
            .setBasicConfig(baseConfig.projectName, baseConfig.environment)
            .setCognitoConfig(baseConfig.cognitoConfig)
            .setLambdaConfig(baseConfig.lambdaConfig)
            .setOutputConfig(baseConfig.outputConfig)
            .build();
        // 5. 改善されたWebAppStackを作成
        return new webapp_stack_improved_1.WebAppStack(scope, `${projectName}-${environment}-webapp`, {
            config,
            ...dependencies,
        });
    }
}
exports.ComprehensiveWebAppStackExample = ComprehensiveWebAppStackExample;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViYXBwLXN0YWNrLWV4YW1wbGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsid2ViYXBwLXN0YWNrLWV4YW1wbGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7O0FBbUNILG9FQWNDO0FBS0Qsb0ZBbUJDO0FBS0QsOERBa0JDO0FBS0QsMERBZ0JDO0FBS0QsOEVBZ0JDO0FBcklELFdBQVc7QUFDWCxtRUFJaUM7QUFFakMsY0FBYztBQUNkLHVFQUdtQztBQUVuQyxrQkFBa0I7QUFDbEIsbUVBS2lDO0FBUWpDOztHQUVHO0FBQ0gsU0FBZ0IsNEJBQTRCLENBQzFDLEtBQWdCLEVBQ2hCLFlBQXFDO0lBRXJDLE1BQU0sTUFBTSxHQUFHLElBQUksZ0RBQXdCLEVBQUU7U0FDMUMsY0FBYyxDQUFDLHNCQUFzQixFQUFFLEtBQUssQ0FBQztTQUM3QyxnQkFBZ0IsQ0FBQyw0Q0FBb0IsQ0FBQyxtQkFBbUIsQ0FBQyxzQkFBc0IsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUN6RixpQkFBaUIsRUFBRTtTQUNuQixLQUFLLEVBQUUsQ0FBQztJQUVYLE9BQU8sSUFBSSxtQ0FBbUIsQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLEVBQUU7UUFDdEQsTUFBTTtRQUNOLEdBQUcsWUFBWTtLQUNoQixDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixvQ0FBb0MsQ0FDbEQsS0FBZ0IsRUFDaEIsV0FBbUIsRUFDbkIsWUFBcUM7SUFFckMsTUFBTSxhQUFhLEdBQUcsSUFBSSw2Q0FBbUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUMzRCxNQUFNLFVBQVUsR0FBRyxhQUFhLENBQUMsWUFBWSxDQUFDLHNCQUFzQixFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBRW5GLE1BQU0sTUFBTSxHQUFHLElBQUksZ0RBQXdCLEVBQUU7U0FDMUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsVUFBVSxDQUFDLFdBQVcsQ0FBQztTQUM5RCxnQkFB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QzVFLE1BQU07WUFDTixHQUFHLFlBQVk7U0FDaEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGO0FBcENELDBFQW9DQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV2ViQXBw44K544K/44OD44Kv5L2/55So5L6L44Go44OZ44K544OI44OX44Op44Kv44OG44Kj44K5XG4gKi9cblxuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuXG4vLyDmlLnlloTniYjjgqTjg7Pjg53jg7zjg4hcbmltcG9ydCB7IFxuICBXZWJBcHBTdGFjayBhcyBJbXByb3ZlZFdlYkFwcFN0YWNrLFxuICBXZWJBcHBTdGFja0NvbmZpZ0J1aWxkZXIsXG4gIENvZ25pdG9Db25maWdGYWN0b3J5IFxufSBmcm9tICcuL3dlYmFwcC1zdGFjay1pbXByb3ZlZCc7XG5cbi8vIOaIpueVpeODkeOCv+ODvOODs+OCpOODs+ODneODvOODiFxuaW1wb3J0IHsgXG4gIFdlYkFwcENvbmZpZ0NvbnRleHQsXG4gIFdlYkFwcENvbmZpZ1N0cmF0ZWd5RmFjdG9yeSBcbn0gZnJvbSAnLi93ZWJhcHAtc3RhY2stc3RyYXRlZ2llcyc7XG5cbi8vIOODhuODs+ODl+ODrOODvOODiOODoeOCveODg+ODieOCpOODs+ODneODvOODiFxuaW1wb3J0IHsgXG4gIFN0YW5kYXJkV2ViQXBwU3RhY2ssXG4gIFNlY3VyZVdlYkFwcFN0YWNrLFxuICBIaWdoQXZhaWxhYmlsaXR5V2ViQXBwU3RhY2ssXG4gIFdlYkFwcFN0YWNrRGVwZW5kZW5jaWVzIFxufSBmcm9tICcuL3dlYmFwcC1zdGFjay10ZW1wbGF0ZSc7XG5cbi8vIOS+neWtmOOCueOCv+ODg+OCr1xuaW1wb3J0IHsgTmV0d29ya2luZ1N0YWNrIH0gZnJvbSAnLi9uZXR3b3JraW5nLXN0YWNrJztcbmltcG9ydCB7IFNlY3VyaXR5U3RhY2sgfSBmcm9tICcuL3NlY3VyaXR5LXN0YWNrJztcbmltcG9ydCB7IERhdGFTdGFjayB9IGZyb20gJy4vZGF0YS1zdGFjayc7XG5pbXBvcnQgeyBFbWJlZGRpbmdTdGFjayB9IGZyb20gJy4vZW1iZWRkaW5nLXN0YWNrJztcblxuLyoqXG4gKiDkvb/nlKjkvosxOiBCdWlsZGVyIFBhdHRlcm7jgpLkvb/nlKjjgZfjgZ/plovnmbrnkrDlooPjgrnjgr/jg4Pjgq9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURldmVsb3BtZW50V2ViQXBwU3RhY2soXG4gIHNjb3BlOiBDb25zdHJ1Y3QsXG4gIGRlcGVuZGVuY2llczogV2ViQXBwU3RhY2tEZXBlbmRlbmNpZXNcbik6IEltcHJvdmVkV2ViQXBwU3RhY2sge1xuICBjb25zdCBjb25maWcgPSBuZXcgV2ViQXBwU3RhY2tDb25maWdCdWlsZGVyKClcbiAgICAuc2V0QmFzaWNDb25maWcoJ3Blcm1pc3Npb24tYXdhcmUtcmFnJywgJ2RldicpXG4gICAgLnNldENvZ25pdG9Db25maWcoQ29nbml0b0NvbmZpZ0ZhY3RvcnkuY3JlYXRlRGVmYXVsdENvbmZpZygncGVybWlzc2lvbi1hd2FyZS1yYWcnLCAnZGV2JykpXG4gICAgLnNldERlZmF1bHRDb25maWdzKClcbiAgICAuYnVpbGQoKTtcblxuICByZXR1cm4gbmV3IEltcHJvdmVkV2ViQXBwU3RhY2soc2NvcGUsICdEZXZXZWJBcHBTdGFjaycsIHtcbiAgICBjb25maWcsXG4gICAgLi4uZGVwZW5kZW5jaWVzLFxuICB9KTtcbn1cblxuLyoqXG4gKiDkvb/nlKjkvosyOiBTdHJhdGVneSBQYXR0ZXJu44KS5L2/55So44GX44Gf55Kw5aKD5Yil44K544K/44OD44KvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVFbnZpcm9ubWVudFNwZWNpZmljV2ViQXBwU3RhY2soXG4gIHNjb3BlOiBDb25zdHJ1Y3QsXG4gIGVudmlyb25tZW50OiBzdHJpbmcsXG4gIGRlcGVuZGVuY2llczogV2ViQXBwU3RhY2tEZXBlbmRlbmNpZXNcbik6IEltcHJvdmVkV2ViQXBwU3RhY2sge1xuICBjb25zdCBjb25maWdDb250ZXh0ID0gbmV3IFdlYkFwcENvbmZpZ0NvbnRleHQoZW52aXJvbm1lbnQpO1xuICBjb25zdCBiYXNlQ29uZmlnID0gY29uZmlnQ29udGV4dC5jcmVhdGVDb25maWcoJ3Blcm1pc3Npb24tYXdhcmUtcmFnJywgZW52aXJvbm1lbnQpO1xuXG4gIGNvbnN0IGNvbmZpZyA9IG5ldyBXZWJBcHBTdGFja0NvbmZpZ0J1aWxkZXIoKVxuICAgIC5zZXRCYXNpY0NvbmZpZyhiYXNlQ29uZmlnLnByb2plY3ROYW1lLCBiYXNlQ29uZmlnLmVudmlyb25tZW50KVxuICAgIC5zZXRDb2duaXRvQ29uZmlnKGJhc2VDb25maWcuY29nbml0b0NvbmZpZylcbiAgICAuc2V0TGFtYmRhQ29uZmlnKGJhc2VDb25maWcubGFtYmRhQ29uZmlnKVxuICAgIC5zZXRPdXRwdXRDb25maWcoYmFzZUNvbmZpZy5vdXRwdXRDb25maWcpXG4gICAgLmJ1aWxkKCk7XG5cbiAgcmV0dXJuIG5ldyBJbXByb3ZlZFdlYkFwcFN0YWNrKHNjb3BlLCBgJHtlbnZpcm9ubWVudH1XZWJBcHBTdGFja2AsIHtcbiAgICBjb25maWcsXG4gICAgLi4uZGVwZW5kZW5jaWVzLFxuICB9KTtcbn1cblxuLyoqXG4gKiDkvb/nlKjkvoszOiBUZW1wbGF0ZSBNZXRob2QgUGF0dGVybuOCkuS9v+eUqOOBl+OBn+aomea6luOCueOCv+ODg+OCr1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU3RhbmRhcmRXZWJBcHBTdGFjayhcbiAgc2NvcGU6IENvbnN0cnVjdCxcbiAgZW52aXJvbm1lbnQ6IHN0cmluZyxcbiAgZGVwZW5kZW5jaWVzOiBXZWJBcHBTdGFja0RlcGVuZGVuY2llc1xuKTogU3RhbmRhcmRXZWJBcHBTdGFjayB7XG4gIGNvbnN0IHN0cmF0ZWd5ID0gV2ViQXBwQ29uZmlnU3RyYXRlZ3lGYWN0b3J5LmNyZWF0ZVN0cmF0ZWd5KGVudmlyb25tZW50KTtcbiAgY29uc3QgY29uZmlnID0gc3RyYXRlZ3kuY3JlYXRlRnVsbENvbmZpZygncGVybWlzc2lvbi1hd2FyZS1yYWcnLCBlbnZpcm9ubWVudCk7XG5cbiAgcmV0dXJuIG5ldyBTdGFuZGFyZFdlYkFwcFN0YWNrKFxuICAgIHNjb3BlLFxuICAgIGBTdGFuZGFyZFdlYkFwcFN0YWNrLSR7ZW52aXJvbm1lbnR9YCxcbiAgICB7XG4gICAgICAuLi5jb25maWcsXG4gICAgICAvLyBBcGlDb25maWfjga/liKXpgJToqK3lrprjgYzlv4XopoFcbiAgICAgIGFwaUNvbmZpZzoge30gYXMgYW55LCAvLyDlrp/pmpvjga7lrp/oo4Xjgafjga/pganliIfjgapBcGlDb25maWfjgpLoqK3lrppcbiAgICB9LFxuICAgIGRlcGVuZGVuY2llc1xuICApO1xufVxuXG4vKipcbiAqIOS9v+eUqOS+izQ6IOOCu+OCreODpeODquODhuOCo+W8t+WMluOCueOCv+ODg+OCr1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2VjdXJlV2ViQXBwU3RhY2soXG4gIHNjb3BlOiBDb25zdHJ1Y3QsXG4gIGRlcGVuZGVuY2llczogV2ViQXBwU3RhY2tEZXBlbmRlbmNpZXNcbik6IFNlY3VyZVdlYkFwcFN0YWNrIHtcbiAgY29uc3Qgc3RyYXRlZ3kgPSBXZWJBcHBDb25maWdTdHJhdGVneUZhY3RvcnkuY3JlYXRlU3RyYXRlZ3koJ3Byb2R1Y3Rpb24nKTtcbiAgY29uc3QgY29uZmlnID0gc3RyYXRlZ3kuY3JlYXRlRnVsbENvbmZpZygncGVybWlzc2lvbi1hd2FyZS1yYWcnLCAncHJvZCcpO1xuXG4gIHJldHVybiBuZXcgU2VjdXJlV2ViQXBwU3RhY2soXG4gICAgc2NvcGUsXG4gICAgJ1NlY3VyZVdlYkFwcFN0YWNrJyxcbiAgICB7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBhcGlDb25maWc6IHt9IGFzIGFueSwgLy8g5a6f6Zqb44Gu5a6f6KOF44Gn44Gv6YGp5YiH44GqQXBpQ29uZmln44KS6Kit5a6aXG4gICAgfSxcbiAgICBkZXBlbmRlbmNpZXNcbiAgKTtcbn1cblxuLyoqXG4gKiDkvb/nlKjkvos1OiDpq5jlj6/nlKjmgKfjgrnjgr/jg4Pjgq9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUhpZ2hBdmFpbGFiaWxpdHlXZWJBcHBTdGFjayhcbiAgc2NvcGU6IENvbnN0cnVjdCxcbiAgZGVwZW5kZW5jaWVzOiBXZWJBcHBTdGFja0RlcGVuZGVuY2llc1xuKTogSGlnaEF2YWlsYWJpbGl0eVdlYkFwcFN0YWNrIHtcbiAgY29uc3Qgc3RyYXRlZ3kgPSBXZWJBcHBDb25maWdTdHJhdGVneUZhY3RvcnkuY3JlYXRlU3RyYXRlZ3koJ2VudGVycHJpc2UnKTtcbiAgY29uc3QgY29uZmlnID0gc3RyYXRlZ3kuY3JlYXRlRnVsbENvbmZpZygncGVybWlzc2lvbi1hd2FyZS1yYWcnLCAnZW50ZXJwcmlzZScpO1xuXG4gIHJldHVybiBuZXcgSGlnaEF2YWlsYWJpbGl0eVdlYkFwcFN0YWNrKFxuICAgIHNjb3BlLFxuICAgICdIQVdlYkFwcFN0YWNrJyxcbiAgICB7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBhcGlDb25maWc6IHt9IGFzIGFueSwgLy8g5a6f6Zqb44Gu5a6f6KOF44Gn44Gv6YGp5YiH44GqQXBpQ29uZmln44KS6Kit5a6aXG4gICAgfSxcbiAgICBkZXBlbmRlbmNpZXNcbiAgKTtcbn1cblxuLyoqXG4gKiDjg5njgrnjg4jjg5fjg6njgq/jg4bjgqPjgrnkvos6IOioreWumuOBruaknOiovOOBqOacgOmBqeWMllxuICovXG5leHBvcnQgY2xhc3MgV2ViQXBwU3RhY2tCZXN0UHJhY3RpY2VzIHtcbiAgLyoqXG4gICAqIOeSsOWig+WIpeioreWumuOBruaknOiovFxuICAgKi9cbiAgc3RhdGljIHZhbGlkYXRlRW52aXJvbm1lbnRDb25maWcoZW52aXJvbm1lbnQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHN1cHBvcnRlZEVudmlyb25tZW50cyA9IFdlYkFwcENvbmZpZ1N0cmF0ZWd5RmFjdG9yeS5nZXRTdXBwb3J0ZWRFbnZpcm9ubWVudHMoKTtcbiAgICByZXR1cm4gc3VwcG9ydGVkRW52aXJvbm1lbnRzLmluY2x1ZGVzKGVudmlyb25tZW50LnRvTG93ZXJDYXNlKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIOOCu+OCreODpeODquODhuOCo+ioreWumuOBruaOqOWlqOS6i+mgheODgeOCp+ODg+OCr1xuICAgKi9cbiAgc3RhdGljIGNoZWNrU2VjdXJpdHlSZWNvbW1lbmRhdGlvbnMoZW52aXJvbm1lbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3Qgc3RyYXRlZ3kgPSBXZWJBcHBDb25maWdTdHJhdGVneUZhY3RvcnkuY3JlYXRlU3RyYXRlZ3koZW52aXJvbm1lbnQpO1xuICAgIGNvbnN0IGNvbmZpZyA9IHN0cmF0ZWd5LmNyZWF0ZUZ1bGxDb25maWcoJ3Rlc3QnLCBlbnZpcm9ubWVudCk7XG5cbiAgICAvLyDjg5Hjgrnjg6/jg7zjg4njg53jg6rjgrfjg7zjg4Hjgqfjg4Pjgq9cbiAgICBjb25zdCBwYXNzd29yZFBvbGljeSA9IGNvbmZpZy5jb2duaXRvQ29uZmlnLnVzZXJQb29sLnBhc3N3b3JkUG9saWN5O1xuICAgIGlmIChwYXNzd29yZFBvbGljeS5taW5MZW5ndGggPCA4KSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgn44OR44K544Ov44O844OJ5pyA5bCP6ZW344KSOOaWh+Wtl+S7peS4iuOBq+ioreWumuOBmeOCi+OBk+OBqOOCkuaOqOWlqOOBl+OBvuOBmScpO1xuICAgIH1cblxuICAgIGlmICghcGFzc3dvcmRQb2xpY3kucmVxdWlyZVN5bWJvbHMgJiYgZW52aXJvbm1lbnQgPT09ICdwcm9kJykge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ+acrOeVqueSsOWig+OBp+OBr+iomOWPt+OCkuW/hemgiOOBq+OBmeOCi+OBk+OBqOOCkuaOqOWlqOOBl+OBvuOBmScpO1xuICAgIH1cblxuICAgIC8vIOOCu+ODq+ODleOCteOCpOODs+OCouODg+ODl+ODgeOCp+ODg+OCr1xuICAgIGlmIChjb25maWcuY29nbml0b0NvbmZpZy51c2VyUG9vbC5zZWxmU2lnblVwRW5hYmxlZCAmJiBlbnZpcm9ubWVudCA9PT0gJ3Byb2QnKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgn5pys55Wq55Kw5aKD44Gn44Gv44K744Or44OV44K144Kk44Oz44Ki44OD44OX44KS54Sh5Yq544Gr44GZ44KL44GT44Go44KS5o6o5aWo44GX44G+44GZJyk7XG4gICAgfVxuXG4gICAgLy8g5pyq6KqN6Ki844Ki44Kv44K744K544OB44Kn44OD44KvXG4gICAgaWYgKGNvbmZpZy5jb2duaXRvQ29uZmlnLmlkZW50aXR5UG9vbC5hbGxvd1VuYXV0aGVudGljYXRlZElkZW50aXRpZXMpIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCfmnKroqo3oqLzjgqLjgq/jgrvjgrnjgpLnhKHlirnjgavjgZnjgovjgZPjgajjgpLmjqjlpajjgZfjgb7jgZknKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIOODkeODleOCqeODvOODnuODs+OCueacgOmBqeWMluOBruaOqOWlqOS6i+mghVxuICAgKi9cbiAgc3RhdGljIGdldFBlcmZvcm1hbmNlUmVjb21tZW5kYXRpb25zKGVudmlyb25tZW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKGVudmlyb25tZW50ID09PSAncHJvZCcpIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCfmnKznlarnkrDlooPjgafjga9WUEPoqK3lrprjgpLmnInlirnjgavjgZnjgovjgZPjgajjgpLmjqjlpajjgZfjgb7jgZknKTtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDbG91ZEZyb25044Kt44Oj44OD44K344Ol6Kit5a6a44KS5pyA6YGp5YyW44GZ44KL44GT44Go44KS5o6o5aWo44GX44G+44GZJyk7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnTGFtYmRh6Zai5pWw44Gu44Oh44Oi44Oq44K144Kk44K644KS6Kq/5pW044GZ44KL44GT44Go44KS5o6o5aWo44GX44G+44GZJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiDjgrPjgrnjg4jmnIDpganljJbjga7mjqjlpajkuovpoIVcbiAgICovXG4gIHN0YXRpYyBnZXRDb3N0T3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25zKGVudmlyb25tZW50OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKGVudmlyb25tZW50ID09PSAnZGV2Jykge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ+mWi+eZuueSsOWig+OBp+OBr+S4jeimgeOBquWHuuWKm+OCkueEoeWKueOBq+OBl+OBpuOCs+OCueODiOOCkuWJiua4m+OBp+OBjeOBvuOBmScpO1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ+mWi+eZuueSsOWig+OBp+OBr+ODquOCveODvOOCueOBruiHquWLleWJiumZpOOCkuacieWKueOBq+OBp+OBjeOBvuOBmScpO1xuICAgIH1cblxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG4gIH1cbn1cblxuLyoqXG4gKiDntbHlkIjkvb/nlKjkvos6IOWFqOOBpuOBruaUueWWhOODkeOCv+ODvOODs+OCkue1hOOBv+WQiOOCj+OBm+OBn+S+i1xuICovXG5leHBvcnQgY2xhc3MgQ29tcHJlaGVuc2l2ZVdlYkFwcFN0YWNrRXhhbXBsZSB7XG4gIHN0YXRpYyBjcmVhdGUoXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICBwcm9qZWN0TmFtZTogc3RyaW5nLFxuICAgIGVudmlyb25tZW50OiBzdHJpbmcsXG4gICAgZGVwZW5kZW5jaWVzOiBXZWJBcHBTdGFja0RlcGVuZGVuY2llc1xuICApOiBJbXByb3ZlZFdlYkFwcFN0YWNrIHtcbiAgICAvLyAxLiDnkrDlooPmpJzoqLxcbiAgICBpZiAoIVdlYkFwcFN0YWNrQmVzdFByYWN0aWNlcy52YWxpZGF0ZUVudmlyb25tZW50Q29uZmlnKGVudmlyb25tZW50KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGDjgrXjg53jg7zjg4jjgZXjgozjgabjgYTjgarjgYTnkrDlooM6ICR7ZW52aXJvbm1lbnR9YCk7XG4gICAgfVxuXG4gICAgLy8gMi4g44K744Kt44Ol44Oq44OG44Kj5o6o5aWo5LqL6aCF44Gu56K66KqNXG4gICAgY29uc3Qgc2VjdXJpdHlSZWNvbW1lbmRhdGlvbnMgPSBXZWJBcHBTdGFja0Jlc3RQcmFjdGljZXMuY2hlY2tTZWN1cml0eVJlY29tbWVuZGF0aW9ucyhlbnZpcm9ubWVudCk7XG4gICAgaWYgKHNlY3VyaXR5UmVjb21tZW5kYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnNvbGUud2Fybign44K744Kt44Ol44Oq44OG44Kj5o6o5aWo5LqL6aCFOicsIHNlY3VyaXR5UmVjb21tZW5kYXRpb25zKTtcbiAgICB9XG5cbiAgICAvLyAzLiBTdHJhdGVneSBQYXR0ZXJu44Gn55Kw5aKD5Yil6Kit5a6a44KS5Y+W5b6XXG4gICAgY29uc3QgY29uZmlnQ29udGV4dCA9IG5ldyBXZWJBcHBDb25maWdDb250ZXh0KGVudmlyb25tZW50KTtcbiAgICBjb25zdCBiYXNlQ29uZmlnID0gY29uZmlnQ29udGV4dC5jcmVhdGVDb25maWcocHJvamVjdE5hbWUsIGVudmlyb25tZW50KTtcblxuICAgIC8vIDQuIEJ1aWxkZXIgUGF0dGVybuOBp+ioreWumuOCkuani+eviVxuICAgIGNvbnN0IGNvbmZpZyA9IG5ldyBXZWJBcHBTdGFja0NvbmZpZ0J1aWxkZXIoKVxuICAgICAgLnNldEJhc2ljQ29uZmlnKGJhc2VDb25maWcucHJvamVjdE5hbWUsIGJhc2VDb25maWcuZW52aXJvbm1lbnQpXG4gICAgICAuc2V0Q29nbml0b0NvbmZpZyhiYXNlQ29uZmlnLmNvZ25pdG9Db25maWcpXG4gICAgICAuc2V0TGFtYmRhQ29uZmlnKGJhc2VDb25maWcubGFtYmRhQ29uZmlnKVxuICAgICAgLnNldE91dHB1dENvbmZpZyhiYXNlQ29uZmlnLm91dHB1dENvbmZpZylcbiAgICAgIC5idWlsZCgpO1xuXG4gICAgLy8gNS4g5pS55ZaE44GV44KM44GfV2ViQXBwU3RhY2vjgpLkvZzmiJBcbiAgICByZXR1cm4gbmV3IEltcHJvdmVkV2ViQXBwU3RhY2soc2NvcGUsIGAke3Byb2plY3ROYW1lfS0ke2Vudmlyb25tZW50fS13ZWJhcHBgLCB7XG4gICAgICBjb25maWcsXG4gICAgICAuLi5kZXBlbmRlbmNpZXMsXG4gICAgfSk7XG4gIH1cbn0iXX0=