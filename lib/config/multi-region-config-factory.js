"use strict";
/**
 * マルチリージョン設定ファクトリー
 *
 * 機能:
 * - リージョン別設定の一元管理
 * - 設定バリデーション
 * - 自動CIDR計算
 * - コンプライアンス要件チェック
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MultiRegionConfigFactory = void 0;
const multi_region_config_1 = require("./interfaces/multi-region-config");
const vpc_cidr_calculator_1 = require("./utilities/vpc-cidr-calculator");
// リージョン別設定インポート
const tokyo_config_1 = require("./environments/tokyo-config");
const osaka_config_1 = require("./environments/osaka-config");
const apac_config_1 = require("./environments/apac-config");
const eu_config_1 = require("./environments/eu-config");
const us_config_1 = require("./environments/us-config");
const sa_config_1 = require("./environments/sa-config");
/**
 * マルチリージョン設定ファクトリー
 */
class MultiRegionConfigFactory {
    static REGION_CONFIGS = {
        // 日本
        [multi_region_config_1.Region.TOKYO]: tokyo_config_1.TOKYO_MULTI_REGION_CONFIG,
        [multi_region_config_1.Region.OSAKA]: osaka_config_1.OSAKA_MULTI_REGION_CONFIG,
        // APAC
        [multi_region_config_1.Region.SINGAPORE]: apac_config_1.APAC_MULTI_REGION_CONFIG,
        [multi_region_config_1.Region.SYDNEY]: { ...apac_config_1.APAC_MULTI_REGION_CONFIG, primaryRegion: multi_region_config_1.Region.SYDNEY },
        [multi_region_config_1.Region.MUMBAI]: { ...apac_config_1.APAC_MULTI_REGION_CONFIG, primaryRegion: multi_region_config_1.Region.MUMBAI },
        [multi_region_config_1.Region.SEOUL]: { ...apac_config_1.APAC_MULTI_REGION_CONFIG, primaryRegion: multi_region_config_1.Region.SEOUL },
        // EU
        [multi_region_config_1.Region.IRELAND]: eu_config_1.EU_MULTI_REGION_CONFIG,
        [multi_region_config_1.Region.FRANKFURT]: { ...eu_config_1.EU_MULTI_REGION_CONFIG, primaryRegion: multi_region_config_1.Region.FRANKFURT },
        [multi_region_config_1.Region.LONDON]: { ...eu_config_1.EU_MULTI_REGION_CONFIG, primaryRegion: multi_region_config_1.Region.LONDON },
        [multi_region_config_1.Region.PARIS]: { ...eu_config_1.EU_MULTI_REGION_CONFIG, primaryRegion: multi_region_config_1.Region.PARIS },
        // US
        [multi_region_config_1.Region.VIRGINIA]: us_config_1.US_MULTI_REGION_CONFIG,
        [multi_region_config_1.Region.OREGON]: { ...us_config_1.US_MULTI_REGION_CONFIG, primaryRegion: multi_region_config_1.Region.OREGON },
        [multi_region_config_1.Region.OHIO]: { ...us_config_1.US_MULTI_REGION_CONFIG, primaryRegion: multi_region_config_1.Region.OHIO },
        // 南米
        [multi_region_config_1.Region.SAO_PAULO]: sa_config_1.SA_MULTI_REGION_CONFIG,
    };
    /**
     * リージョン設定取得（文字列リージョンから）
     */
    static getRegionConfig(regionString) {
        const region = this.parseRegion(regionString);
        const config = this.getConfig(region);
        return {
            regionName: config.regionConfig.regionName,
            regionPrefix: config.regionConfig.regionPrefix,
        };
    }
    /**
     * 文字列からRegion enumに変換
     */
    static parseRegion(regionString) {
        const regionMap = {
            'ap-northeast-1': multi_region_config_1.Region.TOKYO,
            'ap-northeast-3': multi_region_config_1.Region.OSAKA,
            'ap-southeast-1': multi_region_config_1.Region.SINGAPORE,
            'ap-southeast-2': multi_region_config_1.Region.SYDNEY,
            'ap-south-1': multi_region_config_1.Region.MUMBAI,
            'ap-northeast-2': multi_region_config_1.Region.SEOUL,
            'eu-west-1': multi_region_config_1.Region.IRELAND,
            'eu-central-1': multi_region_config_1.Region.FRANKFURT,
            'eu-west-2': multi_region_config_1.Region.LONDON,
            'eu-west-3': multi_region_config_1.Region.PARIS,
            'us-east-1': multi_region_config_1.Region.VIRGINIA,
            'us-west-2': multi_region_config_1.Region.OREGON,
            'us-east-2': multi_region_config_1.Region.OHIO,
            'sa-east-1': multi_region_config_1.Region.SAO_PAULO,
        };
        const region = regionMap[regionString];
        if (!region) {
            throw new Error(`Unsupported region string: ${regionString}`);
        }
        return region;
    }
    /**
     * リージョン設定取得
     */
    static getConfig(region) {
        const config = this.REGION_CONFIGS[region];
        if (!config) {
            throw new Error(`Unsupported region: ${region}`);
        }
        // CIDR自動計算が有効な場合は計算実行
        if (config.regionConfig.vpcCidr.autoCalculate) {
            const calculatedCidr = vpc_cidr_calculator_1.VpcCidrCalculator.generateVpcCidr(region);
            return {
                ...config,
                networking: {
                    ...config.networking,
                    vpc: {
                        ...config.networking.vpc,
                        cidr: calculatedCidr,
                    },
                },
            };
        }
        return config;
    }
    /**
     * 利用可能リージョン一覧取得
     */
    static getAvailableRegions() {
        return Object.keys(this.REGION_CONFIGS);
    }
    /**
     * 地域別リージョン取得
     */
    static getRegionsByArea() {
        return {
            japan: [multi_region_config_1.Region.TOKYO, multi_region_config_1.Region.OSAKA],
            apac: [multi_region_config_1.Region.SINGAPORE, multi_region_config_1.Region.SYDNEY, multi_region_config_1.Region.MUMBAI, multi_region_config_1.Region.SEOUL],
            eu: [multi_region_config_1.Region.IRELAND, multi_region_config_1.Region.FRANKFURT, multi_region_config_1.Region.LONDON, multi_region_config_1.Region.PARIS],
            us: [multi_region_config_1.Region.VIRGINIA, multi_region_config_1.Region.OREGON, multi_region_config_1.Region.OHIO],
            southAmerica: [multi_region_config_1.Region.SAO_PAULO],
        };
    }
    /**
     * 設定バリデーション
     */
    static validateConfig(config) {
        const errors = [];
        const warnings = [];
        // 基本設定チェック
        if (!config.primaryRegion) {
            errors.push('Primary region is required');
        }
        if (!config.regionConfig) {
            errors.push('Region configuration is required');
        }
        // CIDR競合チェック
        const cidrs = [config.networking.vpc.cidr];
        if (config.secondaryRegion) {
            const secondaryConfig = this.getConfig(config.secondaryRegion);
            cidrs.push(secondaryConfig.networking.vpc.cidr);
        }
        if (vpc_cidr_calculator_1.VpcCidrCalculator.checkCidrConflicts(cidrs)) {
            errors.push('VPC CIDR conflicts detected');
        }
        // コンプライアンス要件チェック
        if (config.regionConfig.compliance.dataResidency && config.secondaryRegion) {
            const primaryArea = this.getRegionArea(config.primaryRegion);
            const secondaryArea = this.getRegionArea(config.secondaryRegion);
            if (primaryArea !== secondaryArea) {
                warnings.push('Cross-region data residency requirements may be violated');
            }
        }
        // 機能可用性チェック
        if (config.storage.fsx.enabled && !config.regionConfig.features.fsxOntap) {
            errors.push(`FSx ONTAP is not available in region: ${config.primaryRegion}`);
        }
        if (config.ai.bedrock.enabled && !config.regionConfig.features.bedrock) {
            errors.push(`Amazon Bedrock is not available in region: ${config.primaryRegion}`);
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings,
        };
    }
    /**
     * リージョンの地域取得
     */
    static getRegionArea(region) {
        const regionsByArea = this.getRegionsByArea();
        for (const [area, regions] of Object.entries(regionsByArea)) {
            if (regions.includes(region)) {
                return area;
            }
        }
        return 'unknown';
    }
    /**
     * カスタム設定作成
     */
    static createCustomConfig(baseRegion, overrides) {
        const baseConfig = this.getConfig(baseRegion);
        return {
            ...baseConfig,
            ...overrides,
            regionConfig: {
                ...baseConfig.regionConfig,
                ...overrides.regionConfig,
            },
        };
    }
    /**
     * 災害復旧ペア設定取得
     */
    static getDisasterRecoveryPairs() {
        return {
            // 日本
            [multi_region_config_1.Region.TOKYO]: multi_region_config_1.Region.OSAKA,
            [multi_region_config_1.Region.OSAKA]: multi_region_config_1.Region.TOKYO,
            // APAC
            [multi_region_config_1.Region.SINGAPORE]: multi_region_config_1.Region.SYDNEY,
            [multi_region_config_1.Region.SYDNEY]: multi_region_config_1.Region.SINGAPORE,
            [multi_region_config_1.Region.MUMBAI]: undefined,
            [multi_region_config_1.Region.SEOUL]: undefined,
            // EU
            [multi_region_config_1.Region.IRELAND]: multi_region_config_1.Region.FRANKFURT,
            [multi_region_config_1.Region.FRANKFURT]: multi_region_config_1.Region.IRELAND,
            [multi_region_config_1.Region.LONDON]: undefined,
            [multi_region_config_1.Region.PARIS]: undefined,
            // US
            [multi_region_config_1.Region.VIRGINIA]: multi_region_config_1.Region.OREGON,
            [multi_region_config_1.Region.OREGON]: multi_region_config_1.Region.VIRGINIA,
            [multi_region_config_1.Region.OHIO]: undefined,
            // 南米
            [multi_region_config_1.Region.SAO_PAULO]: undefined,
        };
    }
    /**
     * コンプライアンス要件サマリー取得
     */
    static getComplianceSummary(region) {
        const config = this.getConfig(region);
        const laws = config.regionConfig.compliance.applicableLaws;
        return laws.map(law => {
            switch (law) {
                case 'PIPA_JP': return '個人情報保護法（日本）';
                case 'FISC': return 'FISC安全対策基準';
                case 'PDPA_SG': return 'PDPA（シンガポール）';
                case 'PRIVACY_ACT_AU': return 'Privacy Act（オーストラリア）';
                case 'DPDP_ACT_IN': return 'DPDP Act（インド）';
                case 'PIPA_KR': return 'PIPA（韓国）';
                case 'GDPR': return 'GDPR（EU一般データ保護規則）';
                case 'BDSG': return 'BDSG（ドイツ連邦データ保護法）';
                case 'UK_GDPR': return 'UK-GDPR（英国GDPR）';
                case 'SOX': return 'SOX法（サーベンス・オクスリー法）';
                case 'HIPAA': return 'HIPAA（医療保険の相互運用性と説明責任に関する法律）';
                case 'CCPA': return 'CCPA（カリフォルニア州消費者プライバシー法）';
                case 'LGPD': return 'LGPD（ブラジル一般データ保護法）';
                default: return law;
            }
        });
    }
}
exports.MultiRegionConfigFactory = MultiRegionConfigFactory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGktcmVnaW9uLWNvbmZpZy1mYWN0b3J5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibXVsdGktcmVnaW9uLWNvbmZpZy1mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7R0FRRzs7O0FBRUgsMEVBQTZFO0FBQzdFLHlFQUFvRTtBQUVwRSxnQkFBZ0I7QUFDaEIsOERBQXdFO0FBQ3hFLDhEQUF3RTtBQUN4RSw0REFBc0U7QUFDdEUsd0RBQWtFO0FBQ2xFLHdEQUFrRTtBQUNsRSx3REFBa0U7QUFXbEU7O0dBRUc7QUFDSCxNQUFhLHdCQUF3QjtJQUMzQixNQUFNLENBQVUsY0FBYyxHQUFzQztRQUMxRSxLQUFLO1FBQ0wsQ0FBQyw0QkFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLHdDQUF5QjtRQUN6QyxDQUFDLDRCQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsd0NBQXlCO1FBRXpDLE9BQU87UUFDUCxDQUFDLDRCQUFNLENBQUMsU0FBUyxDQUFDLEVBQUUsc0NBQXdCO1FBQzVDLENBQUMsNEJBQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsc0NBQXdCLEVBQUUsYUFBYSxFQUFFLDRCQUFNLENBQUMsTUFBTSxFQUFFO1FBQzlFLENBQUMsNEJBQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsc0NBQXdCLEVBQUUsYUFBYSxFQUFFLDRCQUFNLENBQUMsTUFBTSxFQUFFO1FBQzlFLENBQUMsNEJBQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEdBQUcsc0NBQXdCLEVBQUUsYUFBYSxFQUFFLDRCQUFNLENBQUMsS0FBSyxFQUFFO1FBRTVFLEtBQUs7UUFDTCxDQUFDLDRCQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsa0NBQXNCO1FBQ3hDLENBQUMsNEJBQU0sQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLEdBQUcsa0NBQXNCLEVBQUUsYUFBYSxFQUFFLDRCQUFNLENBQUMsU0FBUyxFQUFFO1FBQ2xGLENBQUMsNEJBQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsa0NBQXNCLEVBQUUsYUFBYSxFQUFFLDRCQUFNLENBQUMsTUFBTSxFQUFFO1FBQzVFLENBQUMsNEJBQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEdBQUcsa0NBQXNCLEVBQUUsYUFBYSxFQUFFLDRCQUFNLENBQUMsS0FBSyxFQUFFO1FBRTFFLEtBQUs7UUFDTCxDQUFDLDRCQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsa0NBQXNCO1FBQ3pDLENBQUMsNEJBQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsa0NBQXNCLEVBQUUsYUFBYSxFQUFFLDRCQUFNLENBQUMsTUFBTSxFQUFFO1FBQzVFLENBQUMsNEJBQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEdBQUcsa0NBQXNCLEVBQUUsYUFBYSxFQUFFLDRCQUFNLENBQUMsSUFBSSxFQUFFO1FBRXhFLEtBQUs7UUFDTCxDQUFDLDRCQUFNLENBQUMsU0FBUyxDQUFDLEVBQUUsa0NBQXNCO0tBQzNDLENBQUM7SUFFRjs7T0FFRztJQUNILE1BQU0sQ0FBQyxlQUFlLENBQUMsWUFBb0I7UUFDekMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUM5QyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXRDLE9BQU87WUFDTCxVQUFVLEVBQUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxVQUFVO1lBQzFDLFlBQVksRUFBRSxNQUFNLENBQUMsWUFBWSxDQUFDLFlBQVk7U0FDL0MsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxXQUFXLENBQUMsWUFBb0I7UUFDckMsTUFBTSxTQUFTLEdBQTJCO1lBQ3hDLGdCQUFnQixFQUFFLDRCQUFNLENBQUMsS0FBSztZQUM5QixnQkFBZ0IsRUFBRSw0QkFBTSxDQUFDLEtBQUs7WUFDOUIsZ0JBQWdCLEVBQUUsNEJBQU0sQ0FBQyxTQUFTO1lBQ2xDLGdCQUFnQixFQUFFLDRCQUFNLENBQUMsTUFBTTtZQUMvQixZQUFZLEVBQUUsNEJBQU0sQ0FBQyxNQUFNO1lBQzNCLGdCQUFnQixFQUFFLDRCQUFNLENBQUMsS0FBSztZQUM5QixXQUFXLEVBQUUsNEJBQU0sQ0FBQyxPQUFPO1lBQzNCLGNBQWMsRUFBRSw0QkFBTSxDQUFDLFNBQVM7WUFDaEMsV0FBVyxFQUFFLDRCQUFNLENBQUMsTUFBTTtZQUMxQixXQUFXLEVBQUUsNEJBQU0sQ0FBQyxLQUFLO1lBQ3pCLFdBQVcsRUFBRSw0QkFBTSxDQUFDLFFBQVE7WUFDNUIsV0FBVyxFQUFFLDRCQUFNLENBQUMsTUFBTTtZQUMxQixXQUFXLEVBQUUsNEJBQU0sQ0FBQyxJQUFJO1lBQ3hCLFdBQVcsRUFBRSw0QkFBTSxDQUFDLFNBQVM7U0FDOUIsQ0FBQztRQUVGLE1BQU0sTUFBTSxHQUFHLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDWixNQUFNLElBQUksS0FBSyxDQUFDLDhCQUE4QixZQUFZLEVBQUUsQ0FBQyxDQUFDO1FBQ2hFLENBQUM7UUFFRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQWM7UUFDN0IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMzQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDWixNQUFNLElBQUksS0FBSyxDQUFDLHVCQUF1QixNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ25ELENBQUM7UUFFRCxzQkFBc0I7UUFDdEIsSUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUM5QyxNQUFNLGNBQWMsR0FBRyx1Q0FBaUIsQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDakUsT0FBTztnQkFDTCxHQUFHLE1BQU07Z0JBQ1QsVUFBVSxFQUFFO29CQUNWLEdBQUcsTUFBTSxDQUFDLFVBQVU7b0JBQ3BCLEdBQUcsRUFBRTt3QkFDSCxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRzt3QkFDeEIsSUFBSSxFQUFFLGNBQWM7cUJBQ3JCO2lCQUNGO2FBQ0YsQ0FBQztRQUNKLENBQUM7UUFFRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsbUJBQW1CO1FBQ3hCLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFhLENBQUM7SUFDdEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLGdCQUFnQjtRQUNyQixPQUFPO1lBQ0wsS0FBSyxFQUFFLENBQUMsNEJBQU0sQ0FBQyxLQUFLLEVBQUUsNEJBQU0sQ0FBQyxLQUFLLENBQUM7WUFDbkMsSUFBSSxFQUFFLENBQUMsNEJBQU0sQ0FBQyxTQUFTLEVBQUUsNEJBQU0sQ0FBQyxNQUFNLEVBQUUsNEJBQU0sQ0FBQyxNQUFNLEVBQUUsNEJBQU0sQ0FBQyxLQUFLLENBQUM7WUFDcEUsRUFBRSxFQUFFLENBQUMsNEJBQU0sQ0FBQyxPQUFPLEVBQUUsNEJBQU0sQ0FBQyxTQUFTLEVBQUUsNEJBQU0sQ0FBQyxNQUFNLEVBQUUsNEJBQU0sQ0FBQyxLQUFLLENBQUM7WUFDbkUsRUFBRSxFQUFFLENBQUMsNEJBQU0sQ0FBQyxRQUFRLEVBQUUsNEJBQU0sQ0FBQyxNQUFNLEVBQUUsNEJBQU0sQ0FBQyxJQUFJLENBQUM7WUFDakQsWUFBWSxFQUFFLENBQUMsNEJBQU0sQ0FBQyxTQUFTLENBQUM7U0FDakMsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBeUI7UUFDN0MsTUFBTSxNQUFNLEdBQWEsRUFBRSxDQUFDO1FBQzVCLE1BQU0sUUFBUSxHQUFhLEVBQUUsQ0FBQztRQUU5QixXQUFXO1FBQ1gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLENBQUM7UUFDNUMsQ0FBQztRQUVELElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDekIsTUFBTSxDQUFDLElBQUksQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBQ2xELENBQUM7UUFFRCxhQUFhO1FBQ2IsTUFBTSxLQUFLLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxJQUFJLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUMzQixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUMvRCxLQUFLLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xELENBQUM7UUFFRCxJQUFJLHVDQUFpQixDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDaEQsTUFBTSxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1FBQzdDLENBQUM7UUFFRCxpQkFBaUI7UUFDakIsSUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxhQUFhLElBQUksTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQzNFLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQzdELE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBRWpFLElBQUksV0FBVyxLQUFLLGFBQWEsRUFBRSxDQUFDO2dCQUNsQyxRQUFRLENBQUMsSUFBSSxDQUFDLDBEQUEwRCxDQUFDLENBQUM7WUFDNUUsQ0FBQztRQUNILENBQUM7UUFFRCxZQUFZO1FBQ1osSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUN6RSxNQUFNLENBQUMsSUFBSSxDQUFDLHlDQUF5QyxNQUFNLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQztRQUMvRSxDQUFDO1FBRUQsSUFBSSxNQUFNLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUN2RSxNQUFNLENBQUMsSUFBSSxDQUFDLDhDQUE4QyxNQUFNLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQztRQUNwRixDQUFDO1FBRUQsT0FBTztZQUNMLE9BQU8sRUFBRSxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUM7WUFDNUIsTUFBTTtZQUNOLFFBQVE7U0FDVCxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0ssTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFjO1FBQ3pDLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBRTlDLEtBQUssTUFBTSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUM7WUFDNUQsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7Z0JBQzdCLE9BQU8sSUFBSSxDQUFDO1lBQ2QsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsa0JBQWtCLENBQ3ZCLFVBQWtCLEVBQ2xCLFNBQXFDO1FBRXJDLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFOUMsT0FBTztZQUNMLEdBQUcsVUFBVTtZQUNiLEdBQUcsU0FBUztZQUNaLFlBQVksRUFBRTtnQkFDWixHQUFHLFVBQVUsQ0FBQyxZQUFZO2dCQUMxQixHQUFHLFNBQVMsQ0FBQyxZQUFZO2FBQzFCO1NBQ0YsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyx3QkFBd0I7UUFDN0IsT0FBTztZQUNMLEtBQUs7WUFDTCxDQUFDLDRCQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsNEJBQU0sQ0FBQyxLQUFLO1lBQzVCLENBQUMsNEJBQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSw0QkFBTSxDQUFDLEtBQUs7WUFFNUIsT0FBTztZQUNQLENBQUMsNEJBQU0sQ0FBQyxTQUFTLENBQUMsRUFBRSw0QkFBTSxDQUFDLE1BQU07WUFDakMsQ0FBQyw0QkFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLDRCQUFNLENBQUMsU0FBUztZQUNqQyxDQUFDLDRCQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsU0FBUztZQUMxQixDQUFDLDRCQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsU0FBUztZQUV6QixLQUFLO1lBQ0wsQ0FBQyw0QkFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLDRCQUFNLENBQUMsU0FBUztZQUNsQyxDQUFDLDRCQUFNLENBQUMsU0FBUyxDQUFDLEVBQUUsNEJBQU0sQ0FBQyxPQUFPO1lBQ2xDLENBQUMsNEJBQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxTQUFTO1lBQzFCLENBQUMsNEJBQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxTQUFTO1lBRXpCLEtBQUs7WUFDTCxDQUFDLDRCQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsNEJBQU0sQ0FBQyxNQUFNO1lBQ2hDLENBQUMsNEJBQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSw0QkFBTSxDQUFDLFFBQVE7WUFDaEMsQ0FBQyw0QkFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLFNBQVM7WUFFeEIsS0FBSztZQUNMLENBQUMsNEJBQU0sQ0FBQyxTQUFTLENBQUMsRUFBRSxTQUFTO1NBQzlCLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsb0JBQW9CLENBQUMsTUFBYztRQUN4QyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQztRQUUzRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDcEIsUUFBUSxHQUFHLEVBQUUsQ0FBQztnQkFDWixLQUFLLFNBQVMsQ0FBQyxDQUFDLE9BQU8sYUFBYSxDQUFDO2dCQUNyQyxLQUFLLE1BQU0sQ0FBQyxDQUFDLE9BQU8sWUFBWSxDQUFDO2dCQUNqQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLE9BQU8sY0FBYyxDQUFDO2dCQUN0QyxLQUFLLGdCQUFnQixDQUFDLENBQUMsT0FBTyxzQkFBc0IsQ0FBQztnQkFDckQsS0FBSyxhQUFhLENBQUMsQ0FBQyxPQUFPLGVBQWUsQ0FBQztnQkFDM0MsS0FBSyxTQUFTLENBQUMsQ0FBQyxPQUFPLFVBQVUsQ0FBQztnQkFDbEMsS0FBSyxNQUFNLENBQUMsQ0FBQyxPQUFPLG1CQUFtQixDQUFDO2dCQUN4QyxLQUFLLE1BQU0sQ0FBQyxDQUFDLE9BQU8sbUJBQW1CLENBQUM7Z0JBQ3hDLEtBQUssU0FBUyxDQUFDLENBQUMsT0FBTyxpQkFBaUIsQ0FBQztnQkFDekMsS0FBSyxLQUFLLENBQUMsQ0FBQyxPQUFPLG9CQUFvQixDQUFDO2dCQUN4QyxLQUFLLE9BQU8sQ0FBQyxDQUFDLE9BQU8sOEJBQThCLENBQUM7Z0JBQ3BELEtBQUssTUFBTSxDQUFDLENBQUMsT0FBTywwQkFBMEIsQ0FBQztnQkFDL0MsS0FBSyxNQUFNLENBQUMsQ0FBQyxPQUFPLG9CQUFvQixDQUFDO2dCQUN6QyxPQUFPLENBQUMsQ0FBQyxPQUFPLEdBQUcsQ0FBQztZQUN0QixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDOztBQW5RSCw0REFvUUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIOODnuODq+ODgeODquODvOOCuOODp+ODs+ioreWumuODleOCoeOCr+ODiOODquODvFxuICogXG4gKiDmqZ/og706XG4gKiAtIOODquODvOOCuOODp+ODs+WIpeioreWumuOBruS4gOWFg+euoeeQhlxuICogLSDoqK3lrprjg5Djg6rjg4fjg7zjgrfjg6fjg7NcbiAqIC0g6Ieq5YuVQ0lEUuioiOeul1xuICogLSDjgrPjg7Pjg5fjg6njgqTjgqLjg7PjgrnopoHku7bjg4Hjgqfjg4Pjgq9cbiAqL1xuXG5pbXBvcnQgeyBNdWx0aVJlZ2lvbkNvbmZpZywgUmVnaW9uIH0gZnJvbSAnLi9pbnRlcmZhY2VzL211bHRpLXJlZ2lvbi1jb25maWcnO1xuaW1wb3J0IHsgVnBjQ2lkckNhbGN1bGF0b3IgfSBmcm9tICcuL3V0aWxpdGllcy92cGMtY2lkci1jYWxjdWxhdG9yJztcblxuLy8g44Oq44O844K444On44Oz5Yil6Kit5a6a44Kk44Oz44Od44O844OIXG5pbXBvcnQgeyBUT0tZT19NVUxUSV9SRUdJT05fQ09ORklHIH0gZnJvbSAnLi9lbnZpcm9ubWVudHMvdG9reW8tY29uZmlnJztcbmltcG9ydCB7IE9TQUtBX01VTFRJX1JFR0lPTl9DT05GSUcgfSBmcm9tICcuL2Vudmlyb25tZW50cy9vc2FrYS1jb25maWcnO1xuaW1wb3J0IHsgQVBBQ19NVUxUSV9SRUdJT05fQ09ORklHIH0gZnJvbSAnLi9lbnZpcm9ubWVudHMvYXBhYy1jb25maWcnO1xuaW1wb3J0IHsgRVVfTVVMVElfUkVHSU9OX0NPTkZJRyB9IGZyb20gJy4vZW52aXJvbm1lbnRzL2V1LWNvbmZpZyc7XG5pbXBvcnQgeyBVU19NVUxUSV9SRUdJT05fQ09ORklHIH0gZnJvbSAnLi9lbnZpcm9ubWVudHMvdXMtY29uZmlnJztcbmltcG9ydCB7IFNBX01VTFRJX1JFR0lPTl9DT05GSUcgfSBmcm9tICcuL2Vudmlyb25tZW50cy9zYS1jb25maWcnO1xuXG4vKipcbiAqIOioreWumuODkOODquODh+ODvOOCt+ODp+ODs+e1kOaenFxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbmZpZ1ZhbGlkYXRpb25SZXN1bHQge1xuICByZWFkb25seSBpc1ZhbGlkOiBib29sZWFuO1xuICByZWFkb25seSBlcnJvcnM6IHN0cmluZ1tdO1xuICByZWFkb25seSB3YXJuaW5nczogc3RyaW5nW107XG59XG5cbi8qKlxuICog44Oe44Or44OB44Oq44O844K444On44Oz6Kit5a6a44OV44Kh44Kv44OI44Oq44O8XG4gKi9cbmV4cG9ydCBjbGFzcyBNdWx0aVJlZ2lvbkNvbmZpZ0ZhY3Rvcnkge1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBSRUdJT05fQ09ORklHUzogUmVjb3JkPFJlZ2lvbiwgTXVsdGlSZWdpb25Db25maWc+ID0ge1xuICAgIC8vIOaXpeacrFxuICAgIFtSZWdpb24uVE9LWU9dOiBUT0tZT19NVUxUSV9SRUdJT05fQ09ORklHLFxuICAgIFtSZWdpb24uT1NBS0FdOiBPU0FLQV9NVUxUSV9SRUdJT05fQ09ORklHLFxuICAgIFxuICAgIC8vIEFQQUNcbiAgICBbUmVnaW9uLlNJTkdBUE9SRV06IEFQQUNfTVVMVElfUkVHSU9OX0NPTkZJRyxcbiAgICBbUmVnaW9uLlNZRE5FWV06IHsgLi4uQVBBQ19NVUxUSV9SRUdJT05fQ09ORklHLCBwcmltYXJ5UmVnaW9uOiBSZWdpb24uU1lETkVZIH0sXG4gICAgW1JlZ2lvbi5NVU1CQUldOiB7IC4uLkFQQUNfTVVMVElfUkVHSU9OX0NPTkZJRywgcHJpbWFyeVJlZ2lvbjogUmVnaW9uLk1VTUJBSSB9LFxuICAgIFtSZWdpb24uU0VPVUxdOiB7IC4uLkFQQUNfTVVMVElfUkVHSU9OX0NPTkZJRywgcHJpbWFyeVJlZ2lvbjogUmVnaW9uLlNFT1VMIH0sXG4gICAgXG4gICAgLy8gRVVcbiAgICBbUmVnaW9uLklSRUxBTkRdOiBFVV9NVUxUSV9SRUdJT05fQ09ORklHLFxuICAgIFtSZWdpb24uRlJBTktGVVJUXTogeyAuLi5FVV9NVUxUSV9SRUdJT05fQ09ORklHLCBwcmltYXJ5UmVnaW9uOiBSZWdpb24uRlJBTktGVVJUIH0sXG4gICAgW1JlZ2lvbi5MT05ET05dOiB7IC4uLkVVX01VTFRJX1JFR0lPTl9DT05GSUcsIHByaW1hcnlSZWdpb246IFJlZ2lvbi5MT05ET04gfSxcbiAgICBbUmVnaW9uLlBBUklTXTogeyAuLi5FVV9NVUxUSV9SRUdJT05fQ09ORklHLCBwcmltYXJ5UmVnaW9uOiBSZWdpb24uUEFSSVMgfSxcbiAgICBcbiAgICAvLyBVU1xuICAgIFtSZWdpb24uVklSR0lOSUFdOiBVU19NVUxUSV9SRUdJT05fQ09ORklHLFxuICAgIFtSZWdpb24uT1JFR09OXTogeyAuLi5VU19NVUxUSV9SRUdJT05fQ09ORklHLCBwcmltYXJ5UmVnaW9uOiBSZWdpb24uT1JFR09OIH0sXG4gICAgW1JlZ2lvbi5PSElPXTogeyAuLi5VU19NVUxUSV9SRUdJT05fQ09ORklHLCBwcmltYXJ5UmVnaW9uOiBSZWdpb24uT0hJTyB9LFxuICAgIFxuICAgIC8vIOWNl+exs1xuICAgIFtSZWdpb24uU0FPX1BBVUxPXTogU0FfTVVMVElfUkVHSU9OX0NPTkZJRyxcbiAgfTtcblxuICAvKipcbiAgICog44Oq44O844K444On44Oz6Kit5a6a5Y+W5b6X77yI5paH5a2X5YiX44Oq44O844K444On44Oz44GL44KJ77yJXG4gICAqL1xuICBzdGF0aWMgZ2V0UmVnaW9uQ29uZmlnKHJlZ2lvblN0cmluZzogc3RyaW5nKTogeyByZWdpb25OYW1lOiBzdHJpbmc7IHJlZ2lvblByZWZpeDogc3RyaW5nIH0ge1xuICAgIGNvbnN0IHJlZ2lvbiA9IHRoaXMucGFyc2VSZWdpb24ocmVnaW9uU3RyaW5nKTtcbiAgICBjb25zdCBjb25maWcgPSB0aGlzLmdldENvbmZpZyhyZWdpb24pO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICByZWdpb25OYW1lOiBjb25maWcucmVnaW9uQ29uZmlnLnJlZ2lvbk5hbWUsXG4gICAgICByZWdpb25QcmVmaXg6IGNvbmZpZy5yZWdpb25Db25maWcucmVnaW9uUHJlZml4LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog5paH5a2X5YiX44GL44KJUmVnaW9uIGVudW3jgavlpInmj5tcbiAgICovXG4gIHN0YXRpYyBwYXJzZVJlZ2lvbihyZWdpb25TdHJpbmc6IHN0cmluZyk6IFJlZ2lvbiB7XG4gICAgY29uc3QgcmVnaW9uTWFwOiBSZWNvcmQ8c3RyaW5nLCBSZWdpb24+ID0ge1xuICAgICAgJ2FwLW5vcnRoZWFzdC0xJzogUmVnaW9uLlRPS1lPLFxuICAgICAgJ2FwLW5vcnRoZWFzdC0zJzogUmVnaW9uLk9TQUtBLFxuICAgICAgJ2FwLXNvdXRoZWFzdC0xJzogUmVnaW9uLlNJTkdBUE9SRSxcbiAgICAgICdhcC1zb3V0aGVhc3QtMic6IFJlZ2lvbi5TWURORVksXG4gICAgICAnYXAtc291dGgtMSc6IFJlZ2lvbi5NVU1CQUksXG4gICAgICAnYXAtbm9ydGhlYXN0LTInOiBSZWdpb24uU0VPVUwsXG4gICAgICAnZXUtd2VzdC0xJzogUmVnaW9uLklSRUxBTkQsXG4gICAgICAnZXUtY2VudHJhbC0xJzogUmVnaW9uLkZSQU5LRlVSVCxcbiAgICAgICdldS13ZXN0LTInOiBSZWdpb24uTE9ORE9OLFxuICAgICAgJ2V1LXdlc3QtMyc6IFJlZ2lvbi5QQVJJUyxcbiAgICAgICd1cy1lYXN0LTEnOiBSZWdpb24uVklSR0lOSUEsXG4gICAgICAndXMtd2VzdC0yJzogUmVnaW9uLk9SRUdPTixcbiAgICAgICd1cy1lYXN0LTInOiBSZWdpb24uT0hJTyxcbiAgICAgICdzYS1lYXN0LTEnOiBSZWdpb24uU0FPX1BBVUxPLFxuICAgIH07XG4gICAgXG4gICAgY29uc3QgcmVnaW9uID0gcmVnaW9uTWFwW3JlZ2lvblN0cmluZ107XG4gICAgaWYgKCFyZWdpb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgcmVnaW9uIHN0cmluZzogJHtyZWdpb25TdHJpbmd9YCk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiByZWdpb247XG4gIH1cblxuICAvKipcbiAgICog44Oq44O844K444On44Oz6Kit5a6a5Y+W5b6XXG4gICAqL1xuICBzdGF0aWMgZ2V0Q29uZmlnKHJlZ2lvbjogUmVnaW9uKTogTXVsdGlSZWdpb25Db25maWcge1xuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuUkVHSU9OX0NPTkZJR1NbcmVnaW9uXTtcbiAgICBpZiAoIWNvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCByZWdpb246ICR7cmVnaW9ufWApO1xuICAgIH1cbiAgICBcbiAgICAvLyBDSURS6Ieq5YuV6KiI566X44GM5pyJ5Yq544Gq5aC05ZCI44Gv6KiI566X5a6f6KGMXG4gICAgaWYgKGNvbmZpZy5yZWdpb25Db25maWcudnBjQ2lkci5hdXRvQ2FsY3VsYXRlKSB7XG4gICAgICBjb25zdCBjYWxjdWxhdGVkQ2lkciA9IFZwY0NpZHJDYWxjdWxhdG9yLmdlbmVyYXRlVnBjQ2lkcihyZWdpb24pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uY29uZmlnLFxuICAgICAgICBuZXR3b3JraW5nOiB7XG4gICAgICAgICAgLi4uY29uZmlnLm5ldHdvcmtpbmcsXG4gICAgICAgICAgdnBjOiB7XG4gICAgICAgICAgICAuLi5jb25maWcubmV0d29ya2luZy52cGMsXG4gICAgICAgICAgICBjaWRyOiBjYWxjdWxhdGVkQ2lkcixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGNvbmZpZztcbiAgfVxuXG4gIC8qKlxuICAgKiDliKnnlKjlj6/og73jg6rjg7zjgrjjg6fjg7PkuIDopqflj5blvpdcbiAgICovXG4gIHN0YXRpYyBnZXRBdmFpbGFibGVSZWdpb25zKCk6IFJlZ2lvbltdIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5SRUdJT05fQ09ORklHUykgYXMgUmVnaW9uW107XG4gIH1cblxuICAvKipcbiAgICog5Zyw5Z+f5Yil44Oq44O844K444On44Oz5Y+W5b6XXG4gICAqL1xuICBzdGF0aWMgZ2V0UmVnaW9uc0J5QXJlYSgpOiBSZWNvcmQ8c3RyaW5nLCBSZWdpb25bXT4ge1xuICAgIHJldHVybiB7XG4gICAgICBqYXBhbjogW1JlZ2lvbi5UT0tZTywgUmVnaW9uLk9TQUtBXSxcbiAgICAgIGFwYWM6IFtSZWdpb24uU0lOR0FQT1JFLCBSZWdpb24uU1lETkVZLCBSZWdpb24uTVVNQkFJLCBSZWdpb24uU0VPVUxdLFxuICAgICAgZXU6IFtSZWdpb24uSVJFTEFORCwgUmVnaW9uLkZSQU5LRlVSVCwgUmVnaW9uLkxPTkRPTiwgUmVnaW9uLlBBUklTXSxcbiAgICAgIHVzOiBbUmVnaW9uLlZJUkdJTklBLCBSZWdpb24uT1JFR09OLCBSZWdpb24uT0hJT10sXG4gICAgICBzb3V0aEFtZXJpY2E6IFtSZWdpb24uU0FPX1BBVUxPXSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOioreWumuODkOODquODh+ODvOOCt+ODp+ODs1xuICAgKi9cbiAgc3RhdGljIHZhbGlkYXRlQ29uZmlnKGNvbmZpZzogTXVsdGlSZWdpb25Db25maWcpOiBDb25maWdWYWxpZGF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3Qgd2FybmluZ3M6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyDln7rmnKzoqK3lrprjg4Hjgqfjg4Pjgq9cbiAgICBpZiAoIWNvbmZpZy5wcmltYXJ5UmVnaW9uKSB7XG4gICAgICBlcnJvcnMucHVzaCgnUHJpbWFyeSByZWdpb24gaXMgcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWNvbmZpZy5yZWdpb25Db25maWcpIHtcbiAgICAgIGVycm9ycy5wdXNoKCdSZWdpb24gY29uZmlndXJhdGlvbiBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIC8vIENJRFLnq7blkIjjg4Hjgqfjg4Pjgq9cbiAgICBjb25zdCBjaWRycyA9IFtjb25maWcubmV0d29ya2luZy52cGMuY2lkcl07XG4gICAgaWYgKGNvbmZpZy5zZWNvbmRhcnlSZWdpb24pIHtcbiAgICAgIGNvbnN0IHNlY29uZGFyeUNvbmZpZyA9IHRoaXMuZ2V0Q29uZmlnKGNvbmZpZy5zZWNvbmRhcnlSZWdpb24pO1xuICAgICAgY2lkcnMucHVzaChzZWNvbmRhcnlDb25maWcubmV0d29ya2luZy52cGMuY2lkcik7XG4gICAgfVxuXG4gICAgaWYgKFZwY0NpZHJDYWxjdWxhdG9yLmNoZWNrQ2lkckNvbmZsaWN0cyhjaWRycykpIHtcbiAgICAgIGVycm9ycy5wdXNoKCdWUEMgQ0lEUiBjb25mbGljdHMgZGV0ZWN0ZWQnKTtcbiAgICB9XG5cbiAgICAvLyDjgrPjg7Pjg5fjg6njgqTjgqLjg7PjgrnopoHku7bjg4Hjgqfjg4Pjgq9cbiAgICBpZiAoY29uZmlnLnJlZ2lvbkNvbmZpZy5jb21wbGlhbmNlLmRhdGFSZXNpZGVuY3kgJiYgY29uZmlnLnNlY29uZGFyeVJlZ2lvbikge1xuICAgICAgY29uc3QgcHJpbWFyeUFyZWEgPSB0aGlzLmdldFJlZ2lvbkFyZWEoY29uZmlnLnByaW1hcnlSZWdpb24pO1xuICAgICAgY29uc3Qgc2Vjb25kYXJ5QXJlYSA9IHRoaXMuZ2V0UmVnaW9uQXJlYShjb25maWcuc2Vjb25kYXJ5UmVnaW9uKTtcbiAgICAgIFxuICAgICAgaWYgKHByaW1hcnlBcmVhICE9PSBzZWNvbmRhcnlBcmVhKSB7XG4gICAgICAgIHdhcm5pbmdzLnB1c2goJ0Nyb3NzLXJlZ2lvbiBkYXRhIHJlc2lkZW5jeSByZXF1aXJlbWVudHMgbWF5IGJlIHZpb2xhdGVkJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5qmf6IO95Y+v55So5oCn44OB44Kn44OD44KvXG4gICAgaWYgKGNvbmZpZy5zdG9yYWdlLmZzeC5lbmFibGVkICYmICFjb25maWcucmVnaW9uQ29uZmlnLmZlYXR1cmVzLmZzeE9udGFwKSB7XG4gICAgICBlcnJvcnMucHVzaChgRlN4IE9OVEFQIGlzIG5vdCBhdmFpbGFibGUgaW4gcmVnaW9uOiAke2NvbmZpZy5wcmltYXJ5UmVnaW9ufWApO1xuICAgIH1cblxuICAgIGlmIChjb25maWcuYWkuYmVkcm9jay5lbmFibGVkICYmICFjb25maWcucmVnaW9uQ29uZmlnLmZlYXR1cmVzLmJlZHJvY2spIHtcbiAgICAgIGVycm9ycy5wdXNoKGBBbWF6b24gQmVkcm9jayBpcyBub3QgYXZhaWxhYmxlIGluIHJlZ2lvbjogJHtjb25maWcucHJpbWFyeVJlZ2lvbn1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICAgIGVycm9ycyxcbiAgICAgIHdhcm5pbmdzLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog44Oq44O844K444On44Oz44Gu5Zyw5Z+f5Y+W5b6XXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBnZXRSZWdpb25BcmVhKHJlZ2lvbjogUmVnaW9uKTogc3RyaW5nIHtcbiAgICBjb25zdCByZWdpb25zQnlBcmVhID0gdGhpcy5nZXRSZWdpb25zQnlBcmVhKCk7XG4gICAgXG4gICAgZm9yIChjb25zdCBbYXJlYSwgcmVnaW9uc10gb2YgT2JqZWN0LmVudHJpZXMocmVnaW9uc0J5QXJlYSkpIHtcbiAgICAgIGlmIChyZWdpb25zLmluY2x1ZGVzKHJlZ2lvbikpIHtcbiAgICAgICAgcmV0dXJuIGFyZWE7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiAndW5rbm93bic7XG4gIH1cblxuICAvKipcbiAgICog44Kr44K544K/44Og6Kit5a6a5L2c5oiQXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlQ3VzdG9tQ29uZmlnKFxuICAgIGJhc2VSZWdpb246IFJlZ2lvbixcbiAgICBvdmVycmlkZXM6IFBhcnRpYWw8TXVsdGlSZWdpb25Db25maWc+XG4gICk6IE11bHRpUmVnaW9uQ29uZmlnIHtcbiAgICBjb25zdCBiYXNlQ29uZmlnID0gdGhpcy5nZXRDb25maWcoYmFzZVJlZ2lvbik7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmJhc2VDb25maWcsXG4gICAgICAuLi5vdmVycmlkZXMsXG4gICAgICByZWdpb25Db25maWc6IHtcbiAgICAgICAgLi4uYmFzZUNvbmZpZy5yZWdpb25Db25maWcsXG4gICAgICAgIC4uLm92ZXJyaWRlcy5yZWdpb25Db25maWcsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog54G95a6z5b6p5pen44Oa44Ki6Kit5a6a5Y+W5b6XXG4gICAqL1xuICBzdGF0aWMgZ2V0RGlzYXN0ZXJSZWNvdmVyeVBhaXJzKCk6IFJlY29yZDxSZWdpb24sIFJlZ2lvbiB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB7XG4gICAgICAvLyDml6XmnKxcbiAgICAgIFtSZWdpb24uVE9LWU9dOiBSZWdpb24uT1NBS0EsXG4gICAgICBbUmVnaW9uLk9TQUtBXTogUmVnaW9uLlRPS1lPLFxuICAgICAgXG4gICAgICAvLyBBUEFDXG4gICAgICBbUmVnaW9uLlNJTkdBUE9SRV06IFJlZ2lvbi5TWURORVksXG4gICAgICBbUmVnaW9uLlNZRE5FWV06IFJlZ2lvbi5TSU5HQVBPUkUsXG4gICAgICBbUmVnaW9uLk1VTUJBSV06IHVuZGVmaW5lZCxcbiAgICAgIFtSZWdpb24uU0VPVUxdOiB1bmRlZmluZWQsXG4gICAgICBcbiAgICAgIC8vIEVVXG4gICAgICBbUmVnaW9uLklSRUxBTkRdOiBSZWdpb24uRlJBTktGVVJULFxuICAgICAgW1JlZ2lvbi5GUkFOS0ZVUlRdOiBSZWdpb24uSVJFTEFORCxcbiAgICAgIFtSZWdpb24uTE9ORE9OXTogdW5kZWZpbmVkLFxuICAgICAgW1JlZ2lvbi5QQVJJU106IHVuZGVmaW5lZCxcbiAgICAgIFxuICAgICAgLy8gVVNcbiAgICAgIFtSZWdpb24uVklSR0lOSUFdOiBSZWdpb24uT1JFR09OLFxuICAgICAgW1JlZ2lvbi5PUkVHT05dOiBSZWdpb24uVklSR0lOSUEsXG4gICAgICBbUmVnaW9uLk9ISU9dOiB1bmRlZmluZWQsXG4gICAgICBcbiAgICAgIC8vIOWNl+exs1xuICAgICAgW1JlZ2lvbi5TQU9fUEFVTE9dOiB1bmRlZmluZWQsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDjgrPjg7Pjg5fjg6njgqTjgqLjg7PjgrnopoHku7bjgrXjg57jg6rjg7zlj5blvpdcbiAgICovXG4gIHN0YXRpYyBnZXRDb21wbGlhbmNlU3VtbWFyeShyZWdpb246IFJlZ2lvbik6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBjb25maWcgPSB0aGlzLmdldENvbmZpZyhyZWdpb24pO1xuICAgIGNvbnN0IGxhd3MgPSBjb25maWcucmVnaW9uQ29uZmlnLmNvbXBsaWFuY2UuYXBwbGljYWJsZUxhd3M7XG4gICAgXG4gICAgcmV0dXJuIGxhd3MubWFwKGxhdyA9PiB7XG4gICAgICBzd2l0Y2ggKGxhdykge1xuICAgICAgICBjYXNlICdQSVBBX0pQJzogcmV0dXJuICflgIvkurrmg4XloLHkv53orbfms5XvvIjml6XmnKzvvIknO1xuICAgICAgICBjYXNlICdGSVNDJzogcmV0dXJuICdGSVND5a6J5YWo5a++562W5Z+65rqWJztcbiAgICAgICAgY2FzZSAnUERQQV9TRyc6IHJldHVybiAnUERQQe+8iOOCt+ODs+OCrOODneODvOODq++8iSc7XG4gICAgICAgIGNhc2UgJ1BSSVZBQ1lfQUNUX0FVJzogcmV0dXJuICdQcml2YWN5IEFjdO+8iOOCquODvOOCueODiOODqeODquOCou+8iSc7XG4gICAgICAgIGNhc2UgJ0RQRFBfQUNUX0lOJzogcmV0dXJuICdEUERQIEFjdO+8iOOCpOODs+ODie+8iSc7XG4gICAgICAgIGNhc2UgJ1BJUEFfS1InOiByZXR1cm4gJ1BJUEHvvIjpn5Plm73vvIknO1xuICAgICAgICBjYXNlICdHRFBSJzogcmV0dXJuICdHRFBS77yIRVXkuIDoiKzjg4fjg7zjgr/kv53orbfopo/liYfvvIknO1xuICAgICAgICBjYXNlICdCRFNHJzogcmV0dXJuICdCRFNH77yI44OJ44Kk44OE6YCj6YKm44OH44O844K/5L+d6K235rOV77yJJztcbiAgICAgICAgY2FzZSAnVUtfR0RQUic6IHJldHVybiAnVUstR0RQUu+8iOiLseWbvUdEUFLvvIknO1xuICAgICAgICBjYXNlICdTT1gnOiByZXR1cm4gJ1NPWOazle+8iOOCteODvOODmeODs+OCueODu+OCquOCr+OCueODquODvOazle+8iSc7XG4gICAgICAgIGNhc2UgJ0hJUEFBJzogcmV0dXJuICdISVBBQe+8iOWMu+eZguS/nemZuuOBruebuOS6kumBi+eUqOaAp+OBqOiqrOaYjuiyrOS7u+OBq+mWouOBmeOCi+azleW+i++8iSc7XG4gICAgICAgIGNhc2UgJ0NDUEEnOiByZXR1cm4gJ0NDUEHvvIjjgqvjg6rjg5Xjgqnjg6vjg4vjgqLlt57mtojosrvogIXjg5fjg6njgqTjg5Djgrfjg7zms5XvvIknO1xuICAgICAgICBjYXNlICdMR1BEJzogcmV0dXJuICdMR1BE77yI44OW44Op44K444Or5LiA6Iis44OH44O844K/5L+d6K235rOV77yJJztcbiAgICAgICAgZGVmYXVsdDogcmV0dXJuIGxhdztcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSJdfQ==