"use strict";
/**
 * Embedding処理追跡用の型定義
 * ファイル単位でのMarkitdown/LangChain使用状況を追跡
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.EMBEDDING_TRACKING_TABLE_SCHEMA = void 0;
exports.createEmbeddingTrackingRecord = createEmbeddingTrackingRecord;
exports.generateFileHash = generateFileHash;
exports.initializeEmbeddingStats = initializeEmbeddingStats;
/**
 * DynamoDBテーブル設計
 */
exports.EMBEDDING_TRACKING_TABLE_SCHEMA = {
    tableName: 'EmbeddingProcessingTracking',
    partitionKey: 'fileHash',
    sortKey: 'processedAt',
    globalSecondaryIndexes: [
        {
            indexName: 'FileFormatIndex',
            partitionKey: 'fileFormat',
            sortKey: 'processedAt'
        },
        {
            indexName: 'ProcessingMethodIndex',
            partitionKey: 'finalMethod',
            sortKey: 'processedAt'
        },
        {
            indexName: 'UserIndex',
            partitionKey: 'userId',
            sortKey: 'processedAt'
        }
    ],
    ttlAttribute: 'ttl'
};
/**
 * Embedding追跡レコードを作成
 */
function createEmbeddingTrackingRecord(fileHash, embeddingInfo, fileSize, markdownLength, hasError = false, errorMessage, userId, projectId) {
    const now = new Date().toISOString();
    const ttl = Math.floor(Date.now() / 1000) + (90 * 24 * 60 * 60); // 90日後に自動削除
    return {
        fileHash,
        processedAt: embeddingInfo.processedAt,
        fileName: embeddingInfo.fileName,
        fileFormat: embeddingInfo.fileFormat,
        fileSize,
        processingStrategy: embeddingInfo.strategy,
        usedMarkitdown: embeddingInfo.usedMarkitdown,
        usedLangChain: embeddingInfo.usedLangChain,
        finalMethod: embeddingInfo.finalMethod,
        processingTime: embeddingInfo.processingTime,
        qualityScore: embeddingInfo.qualityScore,
        markdownLength,
        hasError,
        errorMessage,
        userId,
        projectId,
        ttl,
        createdAt: now,
        updatedAt: now
    };
}
/**
 * ファイルハッシュを生成
 */
function generateFileHash(fileName, fileSize, lastModified) {
    const content = `${fileName}-${fileSize}-${lastModified?.getTime() || Date.now()}`;
    // 実際の実装では crypto.createHash('sha256') を使用
    return Buffer.from(content).toString('base64').substring(0, 32);
}
/**
 * 統計情報を初期化
 */
function initializeEmbeddingStats() {
    const formatStats = {};
    const formats = ['docx', 'xlsx', 'pptx', 'pdf', 'png', 'jpg', 'jpeg', 'gif', 'html', 'xml', 'csv', 'tsv'];
    formats.forEach(format => {
        formatStats[format] = {
            count: 0,
            markitdownUsage: 0,
            langchainUsage: 0,
            averageProcessingTime: 0,
            averageQualityScore: undefined
        };
    });
    const strategyStats = {
        'markitdown-only': { count: 0, successRate: 0, averageProcessingTime: 0 },
        'langchain-only': { count: 0, successRate: 0, averageProcessingTime: 0 },
        'markitdown-first': { count: 0, successRate: 0, averageProcessingTime: 0 },
        'langchain-first': { count: 0, successRate: 0, averageProcessingTime: 0 },
        'both-compare': { count: 0, successRate: 0, averageProcessingTime: 0 },
        'auto-select': { count: 0, successRate: 0, averageProcessingTime: 0 }
    };
    return {
        totalFiles: 0,
        markitdownFiles: 0,
        langchainFiles: 0,
        bothMethodsFiles: 0,
        formatStats,
        strategyStats,
        period: {
            startDate: new Date().toISOString(),
            endDate: new Date().toISOString()
        }
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1iZWRkaW5nLXRyYWNraW5nLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZW1iZWRkaW5nLXRyYWNraW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7OztBQW9LSCxzRUFrQ0M7QUFLRCw0Q0FJQztBQUtELDREQW1DQztBQWpIRDs7R0FFRztBQUNVLFFBQUEsK0JBQStCLEdBQUc7SUFDN0MsU0FBUyxFQUFFLDZCQUE2QjtJQUN4QyxZQUFZLEVBQUUsVUFBVTtJQUN4QixPQUFPLEVBQUUsYUFBYTtJQUN0QixzQkFBc0IsRUFBRTtRQUN0QjtZQUNFLFNBQVMsRUFBRSxpQkFBaUI7WUFDNUIsWUFBWSxFQUFFLFlBQVk7WUFDMUIsT0FBTyxFQUFFLGFBQWE7U0FDdkI7UUFDRDtZQUNFLFNBQVMsRUFBRSx1QkFBdUI7WUFDbEMsWUFBWSxFQUFFLGFBQWE7WUFDM0IsT0FBTyxFQUFFLGFBQWE7U0FDdkI7UUFDRDtZQUNFLFNBQVMsRUFBRSxXQUFXO1lBQ3RCLFlBQVksRUFBRSxRQUFRO1lBQ3RCLE9BQU8sRUFBRSxhQUFhO1NBQ3ZCO0tBQ0Y7SUFDRCxZQUFZLEVBQUUsS0FBSztDQUNYLENBQUM7QUFFWDs7R0FFRztBQUNILFNBQWdCLDZCQUE2QixDQUMzQyxRQUFnQixFQUNoQixhQUFzQyxFQUN0QyxRQUFnQixFQUNoQixjQUFzQixFQUN0QixXQUFvQixLQUFLLEVBQ3pCLFlBQXFCLEVBQ3JCLE1BQWUsRUFDZixTQUFrQjtJQUVsQixNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3JDLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxZQUFZO0lBRTdFLE9BQU87UUFDTCxRQUFRO1FBQ1IsV0FB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QUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7WUFDbkMsT0FBTyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO1NBQ2xDO0tBQ0YsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEVtYmVkZGluZ+WHpueQhui/vei3oeeUqOOBruWei+Wumue+qVxuICog44OV44Kh44Kk44Or5Y2Y5L2N44Gn44GuTWFya2l0ZG93bi9MYW5nQ2hhaW7kvb/nlKjnirbms4HjgpLov73ot6FcbiAqL1xuXG5pbXBvcnQgeyBTdXBwb3J0ZWRGaWxlRm9ybWF0LCBQcm9jZXNzaW5nU3RyYXRlZ3ksIEVtYmVkZGluZ1Byb2Nlc3NpbmdJbmZvIH0gZnJvbSAnLi9tYXJraXRkb3duLWNvbmZpZyc7XG5cbi8qKlxuICogRHluYW1vRELjgavkv53lrZjjgZnjgotFbWJlZGRpbmfov73ot6Hjg6zjgrPjg7zjg4lcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFbWJlZGRpbmdUcmFja2luZ1JlY29yZCB7XG4gIC8qKiDjg5Hjg7zjg4bjgqPjgrfjg6fjg7Pjgq3jg7w6IOODleOCoeOCpOODq+OBruODj+ODg+OCt+ODpeWApCAqL1xuICBmaWxlSGFzaDogc3RyaW5nO1xuICAvKiog44K944O844OI44Kt44O8OiDlh6bnkIbml6XmmYLvvIhJU0/mloflrZfliJfvvIkgKi9cbiAgcHJvY2Vzc2VkQXQ6IHN0cmluZztcbiAgLyoqIOODleOCoeOCpOODq+WQjSAqL1xuICBmaWxlTmFtZTogc3RyaW5nO1xuICAvKiog44OV44Kh44Kk44Or5b2i5byPICovXG4gIGZpbGVGb3JtYXQ6IFN1cHBvcnRlZEZpbGVGb3JtYXQ7XG4gIC8qKiDjg5XjgqHjgqTjg6vjgrXjgqTjgrrvvIjjg5DjgqTjg4jvvIkgKi9cbiAgZmlsZVNpemU6IG51bWJlcjtcbiAgLyoqIOS9v+eUqOOBleOCjOOBn+WHpueQhuaIpueVpSAqL1xuICBwcm9jZXNzaW5nU3RyYXRlZ3k6IFByb2Nlc3NpbmdTdHJhdGVneTtcbiAgLyoqIE1hcmtpdGRvd27jgYzkvb/nlKjjgZXjgozjgZ/jgYsgKi9cbiAgdXNlZE1hcmtpdGRvd246IGJvb2xlYW47XG4gIC8qKiBMYW5nQ2hhaW7jgYzkvb/nlKjjgZXjgozjgZ/jgYsgKi9cbiAgdXNlZExhbmdDaGFpbjogYm9vbGVhbjtcbiAgLyoqIOacgOe1gueahOOBq+mBuOaKnuOBleOCjOOBn+WHpueQhuaWueazlSAqL1xuICBmaW5hbE1ldGhvZDogJ21hcmtpdGRvd24nIHwgJ2xhbmdjaGFpbic7XG4gIC8qKiDlh6bnkIbmmYLplpPvvIjjg5/jg6rnp5LvvIkgKi9cbiAgcHJvY2Vzc2luZ1RpbWU6IG51bWJlcjtcbiAgLyoqIOWTgeizquOCueOCs+OCou+8iDAtMTAw77yJICovXG4gIHF1YWxpdHlTY29yZT86IG51bWJlcjtcbiAgLyoqIOWkieaPm+W+jOOBruODnuODvOOCr+ODgOOCpuODs+aWh+Wtl+aVsCAqL1xuICBtYXJrZG93bkxlbmd0aDogbnVtYmVyO1xuICAvKiog44Ko44Op44O844GM55m655Sf44GX44Gf44GLICovXG4gIGhhc0Vycm9yOiBib29sZWFuO1xuICAvKiog44Ko44Op44O844Oh44OD44K744O844K477yI5a2Y5Zyo44GZ44KL5aC05ZCI77yJICovXG4gIGVycm9yTWVzc2FnZT86IHN0cmluZztcbiAgLyoqIOODpuODvOOCtuODvElEICovXG4gIHVzZXJJZD86IHN0cmluZztcbiAgLyoqIOODl+ODreOCuOOCp+OCr+ODiElEICovXG4gIHByb2plY3RJZD86IHN0cmluZztcbiAgLyoqIFRUTO+8iOiHquWLleWJiumZpOeUqOOAgVVuaXggdGltZXN0YW1w77yJICovXG4gIHR0bDogbnVtYmVyO1xuICAvKiog5L2c5oiQ5pel5pmCICovXG4gIGNyZWF0ZWRBdDogc3RyaW5nO1xuICAvKiog5pu05paw5pel5pmCICovXG4gIHVwZGF0ZWRBdDogc3RyaW5nO1xufVxuXG4vKipcbiAqIEVtYmVkZGluZ+i/vei3oee1seioiOaDheWgsVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEVtYmVkZGluZ1RyYWNraW5nU3RhdHMge1xuICAvKiog57eP5Yem55CG44OV44Kh44Kk44Or5pWwICovXG4gIHRvdGFsRmlsZXM6IG51bWJlcjtcbiAgLyoqIE1hcmtpdGRvd27jgpLkvb/nlKjjgZfjgZ/jg5XjgqHjgqTjg6vmlbAgKi9cbiAgbWFya2l0ZG93bkZpbGVzOiBudW1iZXI7XG4gIC8qKiBMYW5nQ2hhaW7jgpLkvb/nlKjjgZfjgZ/jg5XjgqHjgqTjg6vmlbAgKi9cbiAgbGFuZ2NoYWluRmlsZXM6IG51bWJlcjtcbiAgLyoqIOS4oeaWueOCkuS9v+eUqOOBl+OBn+ODleOCoeOCpOODq+aVsCAqL1xuICBib3RoTWV0aG9kc0ZpbGVzOiBudW1iZXI7XG4gIC8qKiDjg5XjgqHjgqTjg6vlvaLlvI/liKXntbHoqIggKi9cbiAgZm9ybWF0U3RhdHM6IFJlY29yZDxTdXBwb3J0ZWRGaWxlRm9ybWF0LCB7XG4gICAgY291bnQ6IG51bWJlcjtcbiAgICBtYXJraXRkb3duVXNhZ2U6IG51bWJlcjtcbiAgICBsYW5nY2hhaW5Vc2FnZTogbnVtYmVyO1xuICAgIGF2ZXJhZ2VQcm9jZXNzaW5nVGltZTogbnVtYmVyO1xuICAgIGF2ZXJhZ2VRdWFsaXR5U2NvcmU/OiBudW1iZXI7XG4gIH0+O1xuICAvKiog5Yem55CG5oim55Wl5Yil57Wx6KiIICovXG4gIHN0cmF0ZWd5U3RhdHM6IFJlY29yZDxQcm9jZXNzaW5nU3RyYXRlZ3ksIHtcbiAgICBjb3VudDogbnVtYmVyO1xuICAgIHN1Y2Nlc3NSYXRlOiBudW1iZXI7XG4gICAgYXZlcmFnZVByb2Nlc3NpbmdUaW1lOiBudW1iZXI7XG4gIH0+O1xuICAvKiog5pyf6ZaTICovXG4gIHBlcmlvZDoge1xuICAgIHN0YXJ0RGF0ZTogc3RyaW5nO1xuICAgIGVuZERhdGU6IHN0cmluZztcbiAgfTtcbn1cblxuLyoqXG4gKiBFbWJlZGRpbmfov73ot6Hjgq/jgqjjg6rjg5Hjg6njg6Hjg7zjgr9cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFbWJlZGRpbmdUcmFja2luZ1F1ZXJ5IHtcbiAgLyoqIOODleOCoeOCpOODq+W9ouW8j+OBp+ODleOCo+ODq+OCvyAqL1xuICBmaWxlRm9ybWF0PzogU3VwcG9ydGVkRmlsZUZvcm1hdDtcbiAgLyoqIOWHpueQhuaWueazleOBp+ODleOCo+ODq+OCvyAqL1xuICBwcm9jZXNzaW5nTWV0aG9kPzogJ21hcmtpdGRvd24nIHwgJ2xhbmdjaGFpbic7XG4gIC8qKiDlh6bnkIbmiKbnlaXjgafjg5XjgqPjg6vjgr8gKi9cbiAgcHJvY2Vzc2luZ1N0cmF0ZWd5PzogUHJvY2Vzc2luZ1N0cmF0ZWd5O1xuICAvKiog6ZaL5aeL5pel5pmCICovXG4gIHN0YXJ0RGF0ZT86IHN0cmluZztcbiAgLyoqIOe1guS6huaXpeaZgiAqL1xuICBlbmREYXRlPzogc3RyaW5nO1xuICAvKiog44Om44O844K244O8SUTjgafjg5XjgqPjg6vjgr8gKi9cbiAgdXNlcklkPzogc3RyaW5nO1xuICAvKiog44OX44Ot44K444Kn44Kv44OISUTjgafjg5XjgqPjg6vjgr8gKi9cbiAgcHJvamVjdElkPzogc3RyaW5nO1xuICAvKiog44Ko44Op44O844GC44KK44Gu44G/ICovXG4gIGVycm9yc09ubHk/OiBib29sZWFuO1xuICAvKiog5Yi26ZmQ5pWwICovXG4gIGxpbWl0PzogbnVtYmVyO1xuICAvKiog44Kq44OV44K744OD44OIICovXG4gIG9mZnNldD86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBFbWJlZGRpbmfov73ot6Hjg6zjg53jg7zjg4hcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFbWJlZGRpbmdUcmFja2luZ1JlcG9ydCB7XG4gIC8qKiDjg6zjg53jg7zjg4jnlJ/miJDml6XmmYIgKi9cbiAgZ2VuZXJhdGVkQXQ6IHN0cmluZztcbiAgLyoqIOe1seioiOaDheWgsSAqL1xuICBzdGF0czogRW1iZWRkaW5nVHJhY2tpbmdTdGF0cztcbiAgLyoqIOaOqOWlqOS6i+mghSAqL1xuICByZWNvbW1lbmRhdGlvbnM6IHtcbiAgICAvKiog5Yem55CG5pa55rOV44Gu5o6o5aWo5aSJ5pu0ICovXG4gICAgbWV0aG9kUmVjb21tZW5kYXRpb25zOiBBcnJheTx7XG4gICAgICBmaWxlRm9ybWF0OiBTdXBwb3J0ZWRGaWxlRm9ybWF0O1xuICAgICAgY3VycmVudFN0cmF0ZWd5OiBQcm9jZXNzaW5nU3RyYXRlZ3k7XG4gICAgICByZWNvbW1lbmRlZFN0cmF0ZWd5OiBQcm9jZXNzaW5nU3RyYXRlZ3k7XG4gICAgICByZWFzb246IHN0cmluZztcbiAgICAgIGV4cGVjdGVkSW1wcm92ZW1lbnQ6IHN0cmluZztcbiAgICB9PjtcbiAgICAvKiog44OR44OV44Kp44O844Oe44Oz44K55pS55ZaE5o+Q5qGIICovXG4gICAgcGVyZm9ybWFuY2VJbXByb3ZlbWVudHM6IEFycmF5PHtcbiAgICAgIGFyZWE6IHN0cmluZztcbiAgICAgIHN1Z2dlc3Rpb246IHN0cmluZztcbiAgICAgIGltcGFjdDogJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93JztcbiAgICB9PjtcbiAgfTtcbn1cblxuLyoqXG4gKiBEeW5hbW9EQuODhuODvOODluODq+ioreioiFxuICovXG5leHBvcnQgY29uc3QgRU1CRURESU5HX1RSQUNLSU5HX1RBQkxFX1NDSEVNQSA9IHtcbiAgdGFibGVOYW1lOiAnRW1iZWRkaW5nUHJvY2Vzc2luZ1RyYWNraW5nJyxcbiAgcGFydGl0aW9uS2V5OiAnZmlsZUhhc2gnLFxuICBzb3J0S2V5OiAncHJvY2Vzc2VkQXQnLFxuICBnbG9iYWxTZWNvbmRhcnlJbmRleGVzOiBbXG4gICAge1xuICAgICAgaW5kZXhOYW1lOiAnRmlsZUZvcm1hdEluZGV4JyxcbiAgICAgIHBhcnRpdGlvbktleTogJ2ZpbGVGb3JtYXQnLFxuICAgICAgc29ydEtleTogJ3Byb2Nlc3NlZEF0J1xuICAgIH0sXG4gICAge1xuICAgICAgaW5kZXhOYW1lOiAnUHJvY2Vzc2luZ01ldGhvZEluZGV4JyxcbiAgICAgIHBhcnRpdGlvbktleTogJ2ZpbmFsTWV0aG9kJyxcbiAgICAgIHNvcnRLZXk6ICdwcm9jZXNzZWRBdCdcbiAgICB9LFxuICAgIHtcbiAgICAgIGluZGV4TmFtZTogJ1VzZXJJbmRleCcsXG4gICAgICBwYXJ0aXRpb25LZXk6ICd1c2VySWQnLFxuICAgICAgc29ydEtleTogJ3Byb2Nlc3NlZEF0J1xuICAgIH1cbiAgXSxcbiAgdHRsQXR0cmlidXRlOiAndHRsJ1xufSBhcyBjb25zdDtcblxuLyoqXG4gKiBFbWJlZGRpbmfov73ot6Hjg6zjgrPjg7zjg4njgpLkvZzmiJBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVtYmVkZGluZ1RyYWNraW5nUmVjb3JkKFxuICBmaWxlSGFzaDogc3RyaW5nLFxuICBlbWJlZGRpbmdJbmZvOiBFbWJlZGRpbmdQcm9jZXNzaW5nSW5mbyxcbiAgZmlsZVNpemU6IG51bWJlcixcbiAgbWFya2Rvd25MZW5ndGg6IG51bWJlcixcbiAgaGFzRXJyb3I6IGJvb2xlYW4gPSBmYWxzZSxcbiAgZXJyb3JNZXNzYWdlPzogc3RyaW5nLFxuICB1c2VySWQ/OiBzdHJpbmcsXG4gIHByb2plY3RJZD86IHN0cmluZ1xuKTogRW1iZWRkaW5nVHJhY2tpbmdSZWNvcmQge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIGNvbnN0IHR0bCA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApICsgKDkwICogMjQgKiA2MCAqIDYwKTsgLy8gOTDml6Xlvozjgavoh6rli5XliYrpmaRcblxuICByZXR1cm4ge1xuICAgIGZpbGVIYXNoLFxuICAgIHByb2Nlc3NlZEF0OiBlbWJlZGRpbmdJbmZvLnByb2Nlc3NlZEF0LFxuICAgIGZpbGVOYW1lOiBlbWJlZGRpbmdJbmZvLmZpbGVOYW1lLFxuICAgIGZpbGVGb3JtYXQ6IGVtYmVkZGluZ0luZm8uZmlsZUZvcm1hdCxcbiAgICBmaWxlU2l6ZSxcbiAgICBwcm9jZXNzaW5nU3RyYXRlZ3k6IGVtYmVkZGluZ0luZm8uc3RyYXRlZ3ksXG4gICAgdXNlZE1hcmtpdGRvd246IGVtYmVkZGluZ0luZm8udXNlZE1hcmtpdGRvd24sXG4gICAgdXNlZExhbmdDaGFpbjogZW1iZWRkaW5nSW5mby51c2VkTGFuZ0NoYWluLFxuICAgIGZpbmFsTWV0aG9kOiBlbWJlZGRpbmdJbmZvLmZpbmFsTWV0aG9kLFxuICAgIHByb2Nlc3NpbmdUaW1lOiBlbWJlZGRpbmdJbmZvLnByb2Nlc3NpbmdUaW1lLFxuICAgIHF1YWxpdHlTY29yZTogZW1iZWRkaW5nSW5mby5xdWFsaXR5U2NvcmUsXG4gICAgbWFya2Rvd25MZW5ndGgsXG4gICAgaGFzRXJyb3IsXG4gICAgZXJyb3JNZXNzYWdlLFxuICAgIHVzZXJJZCxcbiAgICBwcm9qZWN0SWQsXG4gICAgdHRsLFxuICAgIGNyZWF0ZWRBdDogbm93LFxuICAgIHVwZGF0ZWRBdDogbm93XG4gIH07XG59XG5cbi8qKlxuICog44OV44Kh44Kk44Or44OP44OD44K344Ol44KS55Sf5oiQXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUZpbGVIYXNoKGZpbGVOYW1lOiBzdHJpbmcsIGZpbGVTaXplOiBudW1iZXIsIGxhc3RNb2RpZmllZD86IERhdGUpOiBzdHJpbmcge1xuICBjb25zdCBjb250ZW50ID0gYCR7ZmlsZU5hbWV9LSR7ZmlsZVNpemV9LSR7bGFzdE1vZGlmaWVkPy5nZXRUaW1lKCkgfHwgRGF0ZS5ub3coKX1gO1xuICAvLyDlrp/pmpvjga7lrp/oo4Xjgafjga8gY3J5cHRvLmNyZWF0ZUhhc2goJ3NoYTI1NicpIOOCkuS9v+eUqFxuICByZXR1cm4gQnVmZmVyLmZyb20oY29udGVudCkudG9TdHJpbmcoJ2Jhc2U2NCcpLnN1YnN0cmluZygwLCAzMik7XG59XG5cbi8qKlxuICog57Wx6KiI5oOF5aCx44KS5Yid5pyf5YyWXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplRW1iZWRkaW5nU3RhdHMoKTogRW1iZWRkaW5nVHJhY2tpbmdTdGF0cyB7XG4gIGNvbnN0IGZvcm1hdFN0YXRzOiBSZWNvcmQ8U3VwcG9ydGVkRmlsZUZvcm1hdCwgYW55PiA9IHt9IGFzIGFueTtcbiAgY29uc3QgZm9ybWF0czogU3VwcG9ydGVkRmlsZUZvcm1hdFtdID0gWydkb2N4JywgJ3hsc3gnLCAncHB0eCcsICdwZGYnLCAncG5nJywgJ2pwZycsICdqcGVnJywgJ2dpZicsICdodG1sJywgJ3htbCcsICdjc3YnLCAndHN2J107XG4gIFxuICBmb3JtYXRzLmZvckVhY2goZm9ybWF0ID0+IHtcbiAgICBmb3JtYXRTdGF0c1tmb3JtYXRdID0ge1xuICAgICAgY291bnQ6IDAsXG4gICAgICBtYXJraXRkb3duVXNhZ2U6IDAsXG4gICAgICBsYW5nY2hhaW5Vc2FnZTogMCxcbiAgICAgIGF2ZXJhZ2VQcm9jZXNzaW5nVGltZTogMCxcbiAgICAgIGF2ZXJhZ2VRdWFsaXR5U2NvcmU6IHVuZGVmaW5lZFxuICAgIH07XG4gIH0pO1xuXG4gIGNvbnN0IHN0cmF0ZWd5U3RhdHM6IFJlY29yZDxQcm9jZXNzaW5nU3RyYXRlZ3ksIGFueT4gPSB7XG4gICAgJ21hcmtpdGRvd24tb25seSc6IHsgY291bnQ6IDAsIHN1Y2Nlc3NSYXRlOiAwLCBhdmVyYWdlUHJvY2Vzc2luZ1RpbWU6IDAgfSxcbiAgICAnbGFuZ2NoYWluLW9ubHknOiB7IGNvdW50OiAwLCBzdWNjZXNzUmF0ZTogMCwgYXZlcmFnZVByb2Nlc3NpbmdUaW1lOiAwIH0sXG4gICAgJ21hcmtpdGRvd24tZmlyc3QnOiB7IGNvdW50OiAwLCBzdWNjZXNzUmF0ZTogMCwgYXZlcmFnZVByb2Nlc3NpbmdUaW1lOiAwIH0sXG4gICAgJ2xhbmdjaGFpbi1maXJzdCc6IHsgY291bnQ6IDAsIHN1Y2Nlc3NSYXRlOiAwLCBhdmVyYWdlUHJvY2Vzc2luZ1RpbWU6IDAgfSxcbiAgICAnYm90aC1jb21wYXJlJzogeyBjb3VudDogMCwgc3VjY2Vzc1JhdGU6IDAsIGF2ZXJhZ2VQcm9jZXNzaW5nVGltZTogMCB9LFxuICAgICdhdXRvLXNlbGVjdCc6IHsgY291bnQ6IDAsIHN1Y2Nlc3NSYXRlOiAwLCBhdmVyYWdlUHJvY2Vzc2luZ1RpbWU6IDAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgdG90YWxGaWxlczogMCxcbiAgICBtYXJraXRkb3duRmlsZXM6IDAsXG4gICAgbGFuZ2NoYWluRmlsZXM6IDAsXG4gICAgYm90aE1ldGhvZHNGaWxlczogMCxcbiAgICBmb3JtYXRTdGF0cyxcbiAgICBzdHJhdGVneVN0YXRzLFxuICAgIHBlcmlvZDoge1xuICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBlbmREYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICB9XG4gIH07XG59Il19