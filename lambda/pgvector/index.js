"use strict";
/*
 *  Copyright 2025 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *  SPDX-License-Identifier: LicenseRef-.amazon.com.-AmznSL-1.0
 *  Licensed under the Amazon Software License  http://aws.amazon.com/asl/
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_rds_data_1 = require("@aws-sdk/client-rds-data");
const handler = async (event, context) => {
    const client = new client_rds_data_1.RDSDataClient({
        region: process.env.AWS_REGION,
    });
    const response = {
        PhysicalResourceId: event.StackId,
    };
    const baseCommand = {
        resourceArn: process.env.RDS_ARN,
        secretArn: process.env.RDS_SECRET_ARN,
    };
    const vectorExtension = new client_rds_data_1.ExecuteStatementCommand({
        ...baseCommand,
        sql: "CREATE EXTENSION IF NOT EXISTS vector",
    });
    const uuidExtension = new client_rds_data_1.ExecuteStatementCommand({
        ...baseCommand,
        sql: 'CREATE EXTENSION IF NOT EXISTS "uuid-ossp"',
    });
    const createDocument = new client_rds_data_1.ExecuteStatementCommand({
        ...baseCommand,
        sql: "CREATE TABLE IF NOT EXISTS documents (id uuid PRIMARY KEY, content TEXT, metadata JSONB, embedding vector(1024))",
    });
    const createIndex = new client_rds_data_1.ExecuteStatementCommand({
        ...baseCommand,
        sql: "CREATE INDEX ON documents USING hnsw (embedding vector_cosine_ops)",
    });
    try {
        await client.send(vectorExtension);
        await client.send(uuidExtension);
        await client.send(createDocument);
        await client.send(createIndex);
        response.Status = "SUCCESS";
        return response;
    }
    catch (error) {
        console.log(error);
        response.Status = "FAILED";
        return response;
    }
};
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7O0FBU0gsOERBR2tDO0FBRTNCLE1BQU0sT0FBTyxHQUFZLEtBQUssRUFDbkMsS0FBNkIsRUFDN0IsT0FBZ0IsRUFDaEIsRUFBRTtJQUNGLE1BQU0sTUFBTSxHQUFHLElBQUksK0JBQWEsQ0FBQztRQUMvQixNQUFNLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVO0tBQy9CLENBQUMsQ0FBQztJQUVILE1BQU0sUUFBUSxHQUE4QjtRQUMxQyxrQkFBa0IsRUFBRSxLQUFLLENBQUMsT0FBTztLQUNsQyxDQUFDO0lBRUYsTUFBTSxXQUFXLEdBQUc7UUFDbEIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTztRQUNoQyxTQUFTLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjO0tBQ3RDLENBQUM7SUFDRixNQUFNLGVBQWUsR0FBRyxJQUFJLHlDQUF1QixDQUFDO1FBQ2xELEdBQUcsV0FBVztRQUNkLEdBQUcsRUFBRSx1Q0FBdUM7S0FDN0MsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxhQUFhLEdBQUcsSUFBSSx5Q0FBdUIsQ0FBQztRQUNoRCxHQUFHLFdBQVc7UUFDZCxHQUFHLEVBQUUsNENBQTRDO0tBQ2xELENBQUMsQ0FBQztJQUVILE1BQU0sY0FBYyxHQUFHLElBQUkseUNBQXVCLENBQUM7UUFDakQsR0FBRyxXQUFXO1FBQ2QsR0FBRyxFQUFFLGtIQUFrSDtLQUN4SCxDQUFDLENBQUM7SUFDSCxNQUFNLFdBQVcsR0FBRyxJQUFJLHlDQUF1QixDQUFDO1FBQzlDLEdBQUcsV0FBVztRQUNkLEdBQUcsRUFBRSxvRUFBb0U7S0FDMUUsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDO1FBQ0gsTUFBTSxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ25DLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNqQyxNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDbEMsTUFBTSxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQy9CLFFBQVEsQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO1FBQzVCLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQixRQUFRLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQztRQUMzQixPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBOUNXLFFBQUEsT0FBTyxXQThDbEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogIENvcHlyaWdodCAyMDI1IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiAgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IExpY2Vuc2VSZWYtLmFtYXpvbi5jb20uLUFtem5TTC0xLjBcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQW1hem9uIFNvZnR3YXJlIExpY2Vuc2UgIGh0dHA6Ly9hd3MuYW1hem9uLmNvbS9hc2wvXG4gKi9cblxuaW1wb3J0IHtcbiAgQ2RrQ3VzdG9tUmVzb3VyY2VFdmVudCxcbiAgQ2RrQ3VzdG9tUmVzb3VyY2VSZXNwb25zZSxcbiAgQ29udGV4dCxcbiAgSGFuZGxlcixcbn0gZnJvbSBcImF3cy1sYW1iZGFcIjtcblxuaW1wb3J0IHtcbiAgUkRTRGF0YUNsaWVudCxcbiAgRXhlY3V0ZVN0YXRlbWVudENvbW1hbmQsXG59IGZyb20gXCJAYXdzLXNkay9jbGllbnQtcmRzLWRhdGFcIjtcblxuZXhwb3J0IGNvbnN0IGhhbmRsZXI6IEhhbmRsZXIgPSBhc3luYyAoXG4gIGV2ZW50OiBDZGtDdXN0b21SZXNvdXJjZUV2ZW50LFxuICBjb250ZXh0OiBDb250ZXh0XG4pID0+IHtcbiAgY29uc3QgY2xpZW50ID0gbmV3IFJEU0RhdGFDbGllbnQoe1xuICAgIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTixcbiAgfSk7XG5cbiAgY29uc3QgcmVzcG9uc2U6IENka0N1c3RvbVJlc291cmNlUmVzcG9uc2UgPSB7XG4gICAgUGh5c2ljYWxSZXNvdXJjZUlkOiBldmVudC5TdGFja0lkLFxuICB9O1xuXG4gIGNvbnN0IGJhc2VDb21tYW5kID0ge1xuICAgIHJlc291cmNlQXJuOiBwcm9jZXNzLmVudi5SRFNfQVJOLFxuICAgIHNlY3JldEFybjogcHJvY2Vzcy5lbnYuUkRTX1NFQ1JFVF9BUk4sXG4gIH07XG4gIGNvbnN0IHZlY3RvckV4dGVuc2lvbiA9IG5ldyBFeGVjdXRlU3RhdGVtZW50Q29tbWFuZCh7XG4gICAgLi4uYmFzZUNvbW1hbmQsXG4gICAgc3FsOiBcIkNSRUFURSBFWFRFTlNJT04gSUYgTk9UIEVYSVNUUyB2ZWN0b3JcIixcbiAgfSk7XG4gIGNvbnN0IHV1aWRFeHRlbnNpb24gPSBuZXcgRXhlY3V0ZVN0YXRlbWVudENvbW1hbmQoe1xuICAgIC4uLmJhc2VDb21tYW5kLFxuICAgIHNxbDogJ0NSRUFURSBFWFRFTlNJT04gSUYgTk9UIEVYSVNUUyBcInV1aWQtb3NzcFwiJyxcbiAgfSk7XG5cbiAgY29uc3QgY3JlYXRlRG9jdW1lbnQgPSBuZXcgRXhlY3V0ZVN0YXRlbWVudENvbW1hbmQoe1xuICAgIC4uLmJhc2VDb21tYW5kLFxuICAgIHNxbDogXCJDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBkb2N1bWVudHMgKGlkIHV1aWQgUFJJTUFSWSBLRVksIGNvbnRlbnQgVEVYVCwgbWV0YWRhdGEgSlNPTkIsIGVtYmVkZGluZyB2ZWN0b3IoMTAyNCkpXCIsXG4gIH0pO1xuICBjb25zdCBjcmVhdGVJbmRleCA9IG5ldyBFeGVjdXRlU3RhdGVtZW50Q29tbWFuZCh7XG4gICAgLi4uYmFzZUNvbW1hbmQsXG4gICAgc3FsOiBcIkNSRUFURSBJTkRFWCBPTiBkb2N1bWVudHMgVVNJTkcgaG5zdyAoZW1iZWRkaW5nIHZlY3Rvcl9jb3NpbmVfb3BzKVwiLFxuICB9KTtcblxuICB0cnkge1xuICAgIGF3YWl0IGNsaWVudC5zZW5kKHZlY3RvckV4dGVuc2lvbik7XG4gICAgYXdhaXQgY2xpZW50LnNlbmQodXVpZEV4dGVuc2lvbik7XG4gICAgYXdhaXQgY2xpZW50LnNlbmQoY3JlYXRlRG9jdW1lbnQpO1xuICAgIGF3YWl0IGNsaWVudC5zZW5kKGNyZWF0ZUluZGV4KTtcbiAgICByZXNwb25zZS5TdGF0dXMgPSBcIlNVQ0NFU1NcIjtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgIHJlc3BvbnNlLlN0YXR1cyA9IFwiRkFJTEVEXCI7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG59O1xuIl19