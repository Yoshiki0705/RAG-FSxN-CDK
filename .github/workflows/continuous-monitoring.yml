name: Continuous Monitoring & Alerts

# ç¶™ç¶šçš„ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
on:
  # å®šæœŸå®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
  schedule:
    # æ¯æ—¥2æ™‚ï¼ˆUTCï¼‰- æ—¥æ¬¡å“è³ªç›£è¦–
    - cron: '0 2 * * *'
    # æ¯é€±æœˆæ›œ14æ™‚ï¼ˆUTCï¼‰- é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ
    - cron: '0 14 * * 1'
    # æ¯æœˆ1æ—¥9æ™‚ï¼ˆUTCï¼‰- æœˆæ¬¡åˆ†æ
    - cron: '0 9 1 * *'
  
  # æ‰‹å‹•å®Ÿè¡Œ
  workflow_dispatch:
    inputs:
      monitoring_type:
        description: 'Monitoring type'
        required: true
        default: 'daily'
        type: choice
        options:
          - daily
          - weekly
          - monthly
          - performance
      notification_level:
        description: 'Notification level'
        required: true
        default: 'normal'
        type: choice
        options:
          - minimal
          - normal
          - detailed
      force_notification:
        description: 'Force notification even on success'
        required: false
        default: false
        type: boolean

# ç’°å¢ƒå¤‰æ•°
env:
  MONITORING_TYPE: ${{ github.event.inputs.monitoring_type || 'daily' }}
  NOTIFICATION_LEVEL: ${{ github.event.inputs.notification_level || 'normal' }}
  FORCE_NOTIFICATION: ${{ github.event.inputs.force_notification || 'false' }}
  METRICS_RETENTION_DAYS: 90

jobs:\n  # ç›£è¦–ã‚¿ã‚¤ãƒ—åˆ¤å®š\n  determine-monitoring:\n    name: Determine Monitoring Type\n    runs-on: ubuntu-latest\n    outputs:\n      monitoring-type: ${{ steps.determine.outputs.monitoring-type }}\n      test-mode: ${{ steps.determine.outputs.test-mode }}\n      notification-required: ${{ steps.determine.outputs.notification-required }}\n    \n    steps:\n      - name: Determine monitoring parameters\n        id: determine\n        run: |\n          # å®Ÿè¡Œã‚¿ã‚¤ãƒ—ã®åˆ¤å®š\n          if [[ \"${{ github.event_name }}\" == \"schedule\" ]]; then\n            # cronå®Ÿè¡Œã®å ´åˆã€æ™‚é–“ã«åŸºã¥ã„ã¦åˆ¤å®š\n            hour=$(date -u +%H)\n            day_of_week=$(date -u +%u)  # 1=Monday, 7=Sunday\n            day_of_month=$(date -u +%d)\n            \n            if [[ \"$hour\" == \"02\" ]]; then\n              monitoring_type=\"daily\"\n            elif [[ \"$hour\" == \"14\" && \"$day_of_week\" == \"1\" ]]; then\n              monitoring_type=\"weekly\"\n            elif [[ \"$hour\" == \"09\" && \"$day_of_month\" == \"01\" ]]; then\n              monitoring_type=\"monthly\"\n            else\n              monitoring_type=\"daily\"\n            fi\n          else\n            monitoring_type=\"$MONITORING_TYPE\"\n          fi\n          \n          # ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã®æ±ºå®š\n          case \"$monitoring_type\" in\n            \"daily\")\n              test_mode=\"full\"\n              notification_required=\"true\"\n              ;;\n            \"weekly\")\n              test_mode=\"full\"\n              notification_required=\"true\"\n              ;;\n            \"monthly\")\n              test_mode=\"full\"\n              notification_required=\"true\"\n              ;;\n            \"performance\")\n              test_mode=\"full\"\n              notification_required=\"false\"\n              ;;\n            *)\n              test_mode=\"full\"\n              notification_required=\"false\"\n              ;;\n          esac\n          \n          echo \"monitoring-type=$monitoring_type\" >> $GITHUB_OUTPUT\n          echo \"test-mode=$test_mode\" >> $GITHUB_OUTPUT\n          echo \"notification-required=$notification_required\" >> $GITHUB_OUTPUT\n          \n          echo \"ğŸ“Š ç›£è¦–è¨­å®š:\"\n          echo \"  ç›£è¦–ã‚¿ã‚¤ãƒ—: $monitoring_type\"\n          echo \"  ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰: $test_mode\"\n          echo \"  é€šçŸ¥å¿…è¦: $notification_required\"\n\n  # ç¶™ç¶šçš„å“è³ªç›£è¦–\n  continuous-quality-monitoring:\n    name: Continuous Quality Monitoring\n    runs-on: ubuntu-latest\n    needs: determine-monitoring\n    timeout-minutes: 20\n    \n    outputs:\n      test-results: ${{ steps.run-monitoring.outputs.test-results }}\n      performance-metrics: ${{ steps.run-monitoring.outputs.performance-metrics }}\n      quality-score: ${{ steps.run-monitoring.outputs.quality-score }}\n      alert-level: ${{ steps.run-monitoring.outputs.alert-level }}\n    \n    steps:\n      - name: Checkout repository\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n      \n      - name: Setup monitoring environment\n        run: |\n          echo \"ğŸ”§ ç›£è¦–ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­\"\n          \n          # å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ\n          mkdir -p development/logs/monitoring\n          mkdir -p development/metrics\n          \n          # å®Ÿè¡Œæ¨©é™è¨­å®š\n          chmod +x development/scripts/testing/quick_integration_test.sh\n          \n          # ç’°å¢ƒæƒ…å ±å‡ºåŠ›\n          echo \"ç›£è¦–ã‚¿ã‚¤ãƒ—: ${{ needs.determine-monitoring.outputs.monitoring-type }}\"\n          echo \"ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰: ${{ needs.determine-monitoring.outputs.test-mode }}\"\n          echo \"é€šçŸ¥ãƒ¬ãƒ™ãƒ«: $NOTIFICATION_LEVEL\"\n          echo \"å®Ÿè¡Œæ™‚åˆ»: $(date '+%Y/%m/%d %H:%M:%S UTC')\"\n      \n      - name: Run continuous monitoring\n        id: run-monitoring\n        run: |\n          echo \"ğŸ“Š ç¶™ç¶šçš„å“è³ªç›£è¦–å®Ÿè¡Œé–‹å§‹\"\n          \n          # ç›£è¦–é–‹å§‹æ™‚åˆ»è¨˜éŒ²\n          START_TIME=$(date +%s%N)\n          MONITORING_ID=\"monitoring_$(date +%Y%m%d_%H%M%S)\"\n          \n          # çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ\n          set +e  # ã‚¨ãƒ©ãƒ¼ã§ã‚‚ç¶™ç¶š\n          ./development/scripts/testing/quick_integration_test.sh \\\n            --mode \"${{ needs.determine-monitoring.outputs.test-mode }}\" \\\n            --environment demo \\\n            --verbose \\\n            --report-format json \\\n            > monitoring_output.log 2>&1\n          \n          TEST_EXIT_CODE=$?\n          \n          # ç›£è¦–çµ‚äº†æ™‚åˆ»è¨˜éŒ²\n          END_TIME=$(date +%s%N)\n          EXECUTION_TIME=$(( (END_TIME - START_TIME) / 1000000 ))  # ãƒŸãƒªç§’\n          \n          echo \"â±ï¸ ç›£è¦–å®Ÿè¡Œå®Œäº†: ${EXECUTION_TIME}ms\"\n          \n          # çµæœè§£æ\n          if [ $TEST_EXIT_CODE -eq 0 ]; then\n            echo \"âœ… å“è³ªç›£è¦–: æ­£å¸¸\"\n            MONITORING_STATUS=\"healthy\"\n            ALERT_LEVEL=\"none\"\n          else\n            echo \"âŒ å“è³ªç›£è¦–: ç•°å¸¸æ¤œçŸ¥\"\n            MONITORING_STATUS=\"unhealthy\"\n            ALERT_LEVEL=\"high\"\n          fi\n          \n          # ãƒ­ã‚°ã‹ã‚‰çµ±è¨ˆæƒ…å ±ã‚’æŠ½å‡º\n          if [ -f monitoring_output.log ]; then\n            TOTAL_TESTS=$(grep -o \"ç·ãƒ†ã‚¹ãƒˆæ•°: [0-9]*\" monitoring_output.log | grep -o \"[0-9]*\" || echo \"0\")\n            SUCCESS_TESTS=$(grep -o \"æˆåŠŸ: [0-9]*\" monitoring_output.log | grep -o \"[0-9]*\" || echo \"0\")\n            FAILED_TESTS=$(grep -o \"å¤±æ•—: [0-9]*\" monitoring_output.log | grep -o \"[0-9]*\" || echo \"0\")\n            \n            # æˆåŠŸç‡è¨ˆç®—\n            if [[ $TOTAL_TESTS -gt 0 ]]; then\n              SUCCESS_RATE=$(echo \"scale=2; $SUCCESS_TESTS * 100 / $TOTAL_TESTS\" | bc -l)\n            else\n              SUCCESS_RATE=\"0\"\n            fi\n          else\n            TOTAL_TESTS=\"0\"\n            SUCCESS_TESTS=\"0\"\n            FAILED_TESTS=\"0\"\n            SUCCESS_RATE=\"0\"\n          fi\n          \n          # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹\n          MEMORY_USAGE=$(free -m | grep '^Mem:' | awk '{print $3}' || echo \"0\")\n          CPU_USAGE=$(top -bn1 | grep \"Cpu(s)\" | awk '{print $2}' | cut -d'%' -f1 || echo \"0\")\n          DISK_USAGE=$(df -h . | tail -1 | awk '{print $5}' | cut -d'%' -f1 || echo \"0\")\n          \n          # å“è³ªã‚¹ã‚³ã‚¢è¨ˆç®—\n          QUALITY_SCORE=0\n          \n          # ãƒ†ã‚¹ãƒˆæˆåŠŸç‡ï¼ˆ50%ï¼‰\n          if (( $(echo \"$SUCCESS_RATE >= 100\" | bc -l) )); then\n            QUALITY_SCORE=$((QUALITY_SCORE + 50))\n          elif (( $(echo \"$SUCCESS_RATE >= 95\" | bc -l) )); then\n            QUALITY_SCORE=$((QUALITY_SCORE + 40))\n          elif (( $(echo \"$SUCCESS_RATE >= 90\" | bc -l) )); then\n            QUALITY_SCORE=$((QUALITY_SCORE + 30))\n          fi\n          \n          # å®Ÿè¡Œæ™‚é–“ï¼ˆ30%ï¼‰\n          if [[ $EXECUTION_TIME -lt 5000 ]]; then\n            QUALITY_SCORE=$((QUALITY_SCORE + 30))\n          elif [[ $EXECUTION_TIME -lt 10000 ]]; then\n            QUALITY_SCORE=$((QUALITY_SCORE + 20))\n          elif [[ $EXECUTION_TIME -lt 15000 ]]; then\n            QUALITY_SCORE=$((QUALITY_SCORE + 10))\n          fi\n          \n          # ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ï¼ˆ20%ï¼‰\n          if [[ $MEMORY_USAGE -lt 1000 && $CPU_USAGE -lt 80 && $DISK_USAGE -lt 80 ]]; then\n            QUALITY_SCORE=$((QUALITY_SCORE + 20))\n          elif [[ $MEMORY_USAGE -lt 2000 && $CPU_USAGE -lt 90 && $DISK_USAGE -lt 90 ]]; then\n            QUALITY_SCORE=$((QUALITY_SCORE + 10))\n          fi\n          \n          # ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«åˆ¤å®š\n          if [[ $QUALITY_SCORE -ge 80 ]]; then\n            ALERT_LEVEL=\"none\"\n          elif [[ $QUALITY_SCORE -ge 60 ]]; then\n            ALERT_LEVEL=\"low\"\n          elif [[ $QUALITY_SCORE -ge 40 ]]; then\n            ALERT_LEVEL=\"medium\"\n          else\n            ALERT_LEVEL=\"high\"\n          fi\n          \n          # çµæœã®JSONå½¢å¼å‡ºåŠ›\n          TEST_RESULTS=$(cat << EOF\n{\n  \"monitoring_id\": \"$MONITORING_ID\",\n  \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\",\n  \"monitoring_type\": \"${{ needs.determine-monitoring.outputs.monitoring-type }}\",\n  \"status\": \"$MONITORING_STATUS\",\n  \"test_results\": {\n    \"total_tests\": $TOTAL_TESTS,\n    \"success_tests\": $SUCCESS_TESTS,\n    \"failed_tests\": $FAILED_TESTS,\n    \"success_rate\": $SUCCESS_RATE,\n    \"execution_time_ms\": $EXECUTION_TIME\n  },\n  \"quality_score\": $QUALITY_SCORE,\n  \"alert_level\": \"$ALERT_LEVEL\"\n}\nEOF\n          )\n          \n          PERFORMANCE_METRICS=$(cat << EOF\n{\n  \"execution_time_ms\": $EXECUTION_TIME,\n  \"memory_usage_mb\": $MEMORY_USAGE,\n  \"cpu_usage_percent\": $CPU_USAGE,\n  \"disk_usage_percent\": $DISK_USAGE,\n  \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"\n}\nEOF\n          )\n          \n          # GitHub Actionså‡ºåŠ›è¨­å®š\n          echo \"test-results<<EOF\" >> $GITHUB_OUTPUT\n          echo \"$TEST_RESULTS\" >> $GITHUB_OUTPUT\n          echo \"EOF\" >> $GITHUB_OUTPUT\n          \n          echo \"performance-metrics<<EOF\" >> $GITHUB_OUTPUT\n          echo \"$PERFORMANCE_METRICS\" >> $GITHUB_OUTPUT\n          echo \"EOF\" >> $GITHUB_OUTPUT\n          \n          echo \"quality-score=$QUALITY_SCORE\" >> $GITHUB_OUTPUT\n          echo \"alert-level=$ALERT_LEVEL\" >> $GITHUB_OUTPUT\n          \n          # ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜\n          echo \"$TEST_RESULTS\" > \"development/metrics/test_results_$MONITORING_ID.json\"\n          echo \"$PERFORMANCE_METRICS\" > \"development/metrics/performance_$MONITORING_ID.json\"\n          \n          # ç›£è¦–çµæœã‚µãƒãƒªãƒ¼\n          echo \"ğŸ“Š ç›£è¦–çµæœã‚µãƒãƒªãƒ¼:\"\n          echo \"  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: $MONITORING_STATUS\"\n          echo \"  å“è³ªã‚¹ã‚³ã‚¢: $QUALITY_SCORE/100\"\n          echo \"  ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«: $ALERT_LEVEL\"\n          echo \"  ãƒ†ã‚¹ãƒˆæˆåŠŸç‡: $SUCCESS_RATE%\"\n          echo \"  å®Ÿè¡Œæ™‚é–“: ${EXECUTION_TIME}ms\"\n          \n          # å¤±æ•—æ™‚ã¯exit codeã‚’è¿”ã™\n          exit $TEST_EXIT_CODE\n      \n      - name: Store metrics data\n        if: always()\n        run: |\n          echo \"ğŸ’¾ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ä¿å­˜ä¸­\"\n          \n          # ãƒ¡ãƒˆãƒªã‚¯ã‚¹å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°\n          HISTORY_FILE=\"development/metrics/monitoring_history.jsonl\"\n          \n          # å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ\n          if [[ ! -f \"$HISTORY_FILE\" ]]; then\n            touch \"$HISTORY_FILE\"\n          fi\n          \n          # æ–°ã—ã„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å±¥æ­´ã«è¿½åŠ \n          echo '${{ steps.run-monitoring.outputs.test-results }}' >> \"$HISTORY_FILE\"\n          \n          # å¤ã„ãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ90æ—¥ä»¥ä¸Šå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ï¼‰\n          CUTOFF_DATE=$(date -d \"90 days ago\" -u +%Y-%m-%dT%H:%M:%SZ)\n          \n          # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã§å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’é™¤å¤–\n          if command -v jq >/dev/null 2>&1; then\n            jq -s --arg cutoff \"$CUTOFF_DATE\" \\\n              'map(select(.timestamp >= $cutoff))' \\\n              \"$HISTORY_FILE\" > \"${HISTORY_FILE}.tmp\" && \\\n              mv \"${HISTORY_FILE}.tmp\" \"$HISTORY_FILE\"\n          fi\n          \n          echo \"âœ… ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ä¿å­˜å®Œäº†\"\n      \n      - name: Upload monitoring artifacts\n        if: always()\n        uses: actions/upload-artifact@v4\n        with:\n          name: monitoring-results-${{ github.run_number }}\n          path: |\n            monitoring_output.log\n            development/metrics/*.json\n            development/metrics/*.jsonl\n            development/logs/monitoring/\n          retention-days: ${{ env.METRICS_RETENTION_DAYS }}\n\n  # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ\n  performance-analysis:\n    name: Performance Analysis\n    runs-on: ubuntu-latest\n    needs: [determine-monitoring, continuous-quality-monitoring]\n    if: always()\n    \n    outputs:\n      performance-trend: ${{ steps.analyze.outputs.performance-trend }}\n      recommendations: ${{ steps.analyze.outputs.recommendations }}\n    \n    steps:\n      - name: Checkout repository\n        uses: actions/checkout@v4\n      \n      - name: Download monitoring results\n        uses: actions/download-artifact@v4\n        with:\n          name: monitoring-results-${{ github.run_number }}\n          path: ./monitoring-data/\n        continue-on-error: true\n      \n      - name: Analyze performance trends\n        id: analyze\n        run: |\n          echo \"ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æå®Ÿè¡Œä¸­\"\n          \n          # ç¾åœ¨ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹\n          CURRENT_QUALITY_SCORE=\"${{ needs.continuous-quality-monitoring.outputs.quality-score }}\"\n          CURRENT_ALERT_LEVEL=\"${{ needs.continuous-quality-monitoring.outputs.alert-level }}\"\n          \n          # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ\n          PERFORMANCE_TREND=\"stable\"\n          RECOMMENDATIONS=\"\"\n          \n          # å“è³ªã‚¹ã‚³ã‚¢ã«åŸºã¥ãåˆ†æ\n          if [[ $CURRENT_QUALITY_SCORE -ge 90 ]]; then\n            PERFORMANCE_TREND=\"excellent\"\n            RECOMMENDATIONS=\"ç¾åœ¨ã®å“è³ªãƒ¬ãƒ™ãƒ«ã‚’ç¶­æŒã—ã¦ãã ã•ã„ã€‚\"\n          elif [[ $CURRENT_QUALITY_SCORE -ge 80 ]]; then\n            PERFORMANCE_TREND=\"good\"\n            RECOMMENDATIONS=\"è‰¯å¥½ãªå“è³ªãƒ¬ãƒ™ãƒ«ã§ã™ã€‚ç¶™ç¶šçš„ãªç›£è¦–ã‚’ç¶šã‘ã¦ãã ã•ã„ã€‚\"\n          elif [[ $CURRENT_QUALITY_SCORE -ge 60 ]]; then\n            PERFORMANCE_TREND=\"declining\"\n            RECOMMENDATIONS=\"å“è³ªã®ä½ä¸‹ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚ãƒ†ã‚¹ãƒˆã®è¦‹ç›´ã—ã‚„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\"\n          else\n            PERFORMANCE_TREND=\"critical\"\n            RECOMMENDATIONS=\"ç·Šæ€¥å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°èª¿æŸ»ã¨æ”¹å–„ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚\"\n          fi\n          \n          # ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã«åŸºã¥ãè¿½åŠ æ¨å¥¨äº‹é …\n          case \"$CURRENT_ALERT_LEVEL\" in\n            \"high\")\n              RECOMMENDATIONS=\"$RECOMMENDATIONS é«˜ãƒ¬ãƒ™ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚å³åº§ã®å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚\"\n              ;;\n            \"medium\")\n              RECOMMENDATIONS=\"$RECOMMENDATIONS ä¸­ãƒ¬ãƒ™ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚è¿‘æ—¥ä¸­ã®å¯¾å¿œã‚’æ¨å¥¨ã—ã¾ã™ã€‚\"\n              ;;\n            \"low\")\n              RECOMMENDATIONS=\"$RECOMMENDATIONS è»½å¾®ãªå•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¦ã„ã¾ã™ã€‚ç›£è¦–ã‚’ç¶™ç¶šã—ã¦ãã ã•ã„ã€‚\"\n              ;;\n          esac\n          \n          echo \"performance-trend=$PERFORMANCE_TREND\" >> $GITHUB_OUTPUT\n          echo \"recommendations<<EOF\" >> $GITHUB_OUTPUT\n          echo \"$RECOMMENDATIONS\" >> $GITHUB_OUTPUT\n          echo \"EOF\" >> $GITHUB_OUTPUT\n          \n          echo \"ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æçµæœ:\"\n          echo \"  ãƒˆãƒ¬ãƒ³ãƒ‰: $PERFORMANCE_TREND\"\n          echo \"  æ¨å¥¨äº‹é …: $RECOMMENDATIONS\"\n\n  # é€šçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ\n  notification-alerts:\n    name: Notifications & Alerts\n    runs-on: ubuntu-latest\n    needs: [determine-monitoring, continuous-quality-monitoring, performance-analysis]\n    if: always() && (needs.determine-monitoring.outputs.notification-required == 'true' || needs.continuous-quality-monitoring.outputs.alert-level != 'none' || github.event.inputs.force_notification == 'true')\n    \n    steps:\n      - name: Prepare notification content\n        id: prepare-notification\n        run: |\n          # é€šçŸ¥å†…å®¹ã®æº–å‚™\n          MONITORING_TYPE=\"${{ needs.determine-monitoring.outputs.monitoring-type }}\"\n          QUALITY_SCORE=\"${{ needs.continuous-quality-monitoring.outputs.quality-score }}\"\n          ALERT_LEVEL=\"${{ needs.continuous-quality-monitoring.outputs.alert-level }}\"\n          PERFORMANCE_TREND=\"${{ needs.performance-analysis.outputs.performance-trend }}\"\n          \n          # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹çµµæ–‡å­—\n          case \"$ALERT_LEVEL\" in\n            \"none\") STATUS_EMOJI=\"âœ…\"; STATUS_TEXT=\"æ­£å¸¸\" ;;\n            \"low\") STATUS_EMOJI=\"âš ï¸\"; STATUS_TEXT=\"æ³¨æ„\" ;;\n            \"medium\") STATUS_EMOJI=\"ğŸ”¶\"; STATUS_TEXT=\"è­¦å‘Š\" ;;\n            \"high\") STATUS_EMOJI=\"ğŸš¨\"; STATUS_TEXT=\"ç·Šæ€¥\" ;;\n            *) STATUS_EMOJI=\"â“\"; STATUS_TEXT=\"ä¸æ˜\" ;;\n          esac\n          \n          # é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ\n          NOTIFICATION_TITLE=\"$STATUS_EMOJI ç¶™ç¶šçš„ç›£è¦–ãƒ¬ãƒãƒ¼ãƒˆ ($MONITORING_TYPE)\"\n          \n          NOTIFICATION_BODY=\"**ç›£è¦–çµæœ**: $STATUS_TEXT\n**å“è³ªã‚¹ã‚³ã‚¢**: $QUALITY_SCORE/100\n**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒˆãƒ¬ãƒ³ãƒ‰**: $PERFORMANCE_TREND\n**å®Ÿè¡Œæ™‚åˆ»**: $(date '+%Y/%m/%d %H:%M:%S UTC')\n\n**æ¨å¥¨äº‹é …**:\n${{ needs.performance-analysis.outputs.recommendations }}\n\n**è©³ç´°**: [ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ #${{ github.run_number }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})\"\n          \n          echo \"notification-title<<EOF\" >> $GITHUB_OUTPUT\n          echo \"$NOTIFICATION_TITLE\" >> $GITHUB_OUTPUT\n          echo \"EOF\" >> $GITHUB_OUTPUT\n          \n          echo \"notification-body<<EOF\" >> $GITHUB_OUTPUT\n          echo \"$NOTIFICATION_BODY\" >> $GITHUB_OUTPUT\n          echo \"EOF\" >> $GITHUB_OUTPUT\n      \n      - name: Create monitoring summary\n        run: |\n          echo \"## ${{ steps.prepare-notification.outputs.notification-title }}\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"${{ steps.prepare-notification.outputs.notification-body }}\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"### ğŸ“Š è©³ç´°ãƒ¡ãƒˆãƒªã‚¯ã‚¹\" >> $GITHUB_STEP_SUMMARY\n          echo \"\\`\\`\\`json\" >> $GITHUB_STEP_SUMMARY\n          echo '${{ needs.continuous-quality-monitoring.outputs.test-results }}' >> $GITHUB_STEP_SUMMARY\n          echo \"\\`\\`\\`\" >> $GITHUB_STEP_SUMMARY\n      \n      # å°†æ¥çš„ã«Slacké€šçŸ¥ã‚’å®Ÿè£…\n      # - name: Send Slack notification\n      #   if: env.SLACK_WEBHOOK_URL != ''\n      #   uses: 8398a7/action-slack@v3\n      #   with:\n      #     status: ${{ needs.continuous-quality-monitoring.outputs.alert-level }}\n      #     title: ${{ steps.prepare-notification.outputs.notification-title }}\n      #     text: ${{ steps.prepare-notification.outputs.notification-body }}\n      #   env:\n      #     SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}\n      \n      - name: Log notification\n        run: |\n          echo \"ğŸ“¢ ç¶™ç¶šçš„ç›£è¦–é€šçŸ¥\"\n          echo \"${{ steps.prepare-notification.outputs.notification-title }}\"\n          echo \"${{ steps.prepare-notification.outputs.notification-body }}\"\n\n  # ç›£è¦–çµæœã‚µãƒãƒªãƒ¼\n  monitoring-summary:\n    name: Monitoring Summary\n    runs-on: ubuntu-latest\n    needs: [determine-monitoring, continuous-quality-monitoring, performance-analysis, notification-alerts]\n    if: always()\n    \n    steps:\n      - name: Generate monitoring summary\n        run: |\n          echo \"ğŸ“Š ç¶™ç¶šçš„ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆå®Ÿè¡Œã‚µãƒãƒªãƒ¼\"\n          echo \"\"\n          echo \"**ç›£è¦–ã‚¿ã‚¤ãƒ—**: ${{ needs.determine-monitoring.outputs.monitoring-type }}\"\n          echo \"**å®Ÿè¡Œçµæœ**: ${{ needs.continuous-quality-monitoring.result }}\"\n          echo \"**å“è³ªã‚¹ã‚³ã‚¢**: ${{ needs.continuous-quality-monitoring.outputs.quality-score }}/100\"\n          echo \"**ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«**: ${{ needs.continuous-quality-monitoring.outputs.alert-level }}\"\n          echo \"**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒˆãƒ¬ãƒ³ãƒ‰**: ${{ needs.performance-analysis.outputs.performance-trend }}\"\n          echo \"**é€šçŸ¥å®Ÿè¡Œ**: ${{ needs.notification-alerts.result }}\"\n          echo \"\"\n          echo \"**å®Ÿè¡Œæ™‚åˆ»**: $(date '+%Y/%m/%d %H:%M:%S UTC')\"\n          echo \"**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: [#${{ github.run_number }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})\"\n          \n          # å…¨ä½“çš„ãªæˆåŠŸåˆ¤å®š\n          if [[ \"${{ needs.continuous-quality-monitoring.result }}\" == \"success\" ]]; then\n            echo \"\"\n            echo \"âœ… ç¶™ç¶šçš„ç›£è¦–ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ\"\n          else\n            echo \"\"\n            echo \"âŒ ç¶™ç¶šçš„ç›£è¦–ã§å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ\"\n          fi"