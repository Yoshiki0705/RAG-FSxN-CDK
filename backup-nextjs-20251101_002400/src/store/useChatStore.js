"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useChatStore = void 0;
const zustand_1 = require("zustand");
exports.useChatStore = (0, zustand_1.create)((set, get) => ({
    // デフォルト設定: 履歴保存は無効
    saveHistory: false,
    setSaveHistory: (save) => set({ saveHistory: save }),
    currentSession: null,
    setCurrentSession: (session) => set({ currentSession: session }),
    chatSessions: [],
    setChatSessions: (sessions) => set({ chatSessions: sessions }),
    addChatSession: (session) => set((state) => ({
        chatSessions: [session, ...state.chatSessions]
    })),
    updateChatSession: (sessionId, updates) => set((state) => ({
        chatSessions: state.chatSessions.map(session => session.id === sessionId ? { ...session, ...updates } : session),
        currentSession: state.currentSession?.id === sessionId
            ? { ...state.currentSession, ...updates }
            : state.currentSession
    })),
    deleteChatSession: (sessionId) => set((state) => ({
        chatSessions: state.chatSessions.filter(session => session.id !== sessionId),
        currentSession: state.currentSession?.id === sessionId ? null : state.currentSession
    })),
    addMessage: (message) => set((state) => {
        if (!state.currentSession)
            return state;
        const updatedSession = {
            ...state.currentSession,
            messages: [...state.currentSession.messages, message],
            updatedAt: new Date()
        };
        return {
            currentSession: updatedSession,
            chatSessions: state.chatSessions.map(session => session.id === updatedSession.id ? updatedSession : session)
        };
    }),
    clearCurrentMessages: () => set((state) => ({
        currentSession: state.currentSession ? {
            ...state.currentSession,
            messages: []
        } : null
    })),
    // DynamoDBへの保存（実装時にAPI呼び出しに置き換え）
    saveChatHistory: async () => {
        const { currentSession, saveHistory } = get();
        if (!saveHistory || !currentSession)
            return;
        try {
            // TODO: DynamoDBへの保存API呼び出し
            console.log('Saving chat history to DynamoDB:', currentSession);
            // 実際の実装では以下のようなAPI呼び出しになります：
            // await fetch('/api/chat/save', {
            //   method: 'POST',
            //   headers: { 'Content-Type': 'application/json' },
            //   body: JSON.stringify(currentSession)
            // });
        }
        catch (error) {
            console.error('Failed to save chat history:', error);
        }
    },
    // DynamoDBからの読み込み（実装時にAPI呼び出しに置き換え）
    loadChatHistory: async (userId) => {
        const { saveHistory } = get();
        if (!saveHistory)
            return;
        try {
            // TODO: DynamoDBからの読み込みAPI呼び出し
            console.log('Loading chat history from DynamoDB for user:', userId);
            // 実際の実装では以下のようなAPI呼び出しになります：
            // const response = await fetch(`/api/chat/history/${userId}`);
            // const sessions = await response.json();
            // set({ chatSessions: sessions });
            // 現在はローカルストレージから読み込み（デモ用）
            const savedSessions = localStorage.getItem(`chatHistory_${userId}`);
            if (savedSessions) {
                const sessions = JSON.parse(savedSessions).map((session) => ({
                    ...session,
                    createdAt: new Date(session.createdAt),
                    updatedAt: new Date(session.updatedAt),
                    messages: session.messages.map((msg) => ({
                        ...msg,
                        timestamp: new Date(msg.timestamp)
                    }))
                }));
                set({ chatSessions: sessions });
            }
        }
        catch (error) {
            console.error('Failed to load chat history:', error);
        }
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlQ2hhdFN0b3JlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXNlQ2hhdFN0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFpQztBQTRDcEIsUUFBQSxZQUFZLEdBQUcsSUFBQSxnQkFBTSxFQUFZLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMzRCxtQkFBbUI7SUFDbkIsV0FBVyxFQUFFLEtBQUs7SUFDbEIsY0FBYyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFFcEQsY0FBYyxFQUFFLElBQUk7SUFDcEIsaUJBQWlCLEVBQUUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLGNBQWMsRUFBRSxPQUFPLEVBQUUsQ0FBQztJQUVoRSxZQUFZLEVBQUUsRUFBRTtJQUNoQixlQUFlLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsQ0FBQztJQUU5RCxjQUFjLEVBQUUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMzQyxZQUFZLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDO0tBQy9DLENBQUMsQ0FBQztJQUVILGlCQUFpQixFQUFFLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3pELFlBQVksRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUM3QyxPQUFPLENBQUMsRUFBRSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLE9BQU8sRUFBRSxHQUFHLE9B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QUE2QjtZQUM3QiwrREFBK0Q7WUFDL0QsMENBQTBDO1lBQzFDLG1DQUFtQztZQUVuQywwQkFBMEI7WUFDMUIsTUFBTSxhQUFhLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxlQUFlLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDcEUsSUFBSSxhQUFhLEVBQUUsQ0FBQztnQkFDbEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7b0JBQ2hFLEdBQUcsT0FBTztvQkFDVixTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQztvQkFDdEMsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7b0JBQ3RDLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQzt3QkFDNUMsR0FBRyxHQUFHO3dCQUNOLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDO3FCQUNuQyxDQUFDLENBQUM7aUJBQ0osQ0FBQyxDQUFDLENBQUM7Z0JBQ0osR0FBRyxDQUFDLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7WUFDbEMsQ0FBQztRQUNILENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RCxDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlIH0gZnJvbSAnenVzdGFuZCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdE1lc3NhZ2Uge1xuICBpZDogc3RyaW5nO1xuICB0ZXh0OiBzdHJpbmc7XG4gIHNlbmRlcjogJ3VzZXInIHwgJ2JvdCc7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgc2Vzc2lvbklkPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRTZXNzaW9uIHtcbiAgaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW107XG4gIGNyZWF0ZWRBdDogRGF0ZTtcbiAgdXBkYXRlZEF0OiBEYXRlO1xuICB1c2VySWQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIENoYXRTdG9yZSB7XG4gIC8vIOODgeODo+ODg+ODiOWxpeattOioreWumlxuICBzYXZlSGlzdG9yeTogYm9vbGVhbjtcbiAgc2V0U2F2ZUhpc3Rvcnk6IChzYXZlOiBib29sZWFuKSA9PiB2b2lkO1xuICBcbiAgLy8g54++5Zyo44Gu44K744OD44K344On44OzXG4gIGN1cnJlbnRTZXNzaW9uOiBDaGF0U2Vzc2lvbiB8IG51bGw7XG4gIHNldEN1cnJlbnRTZXNzaW9uOiAoc2Vzc2lvbjogQ2hhdFNlc3Npb24gfCBudWxsKSA9PiB2b2lkO1xuICBcbiAgLy8g44OB44Oj44OD44OI5bGl5q20XG4gIGNoYXRTZXNzaW9uczogQ2hhdFNlc3Npb25bXTtcbiAgc2V0Q2hhdFNlc3Npb25zOiAoc2Vzc2lvbnM6IENoYXRTZXNzaW9uW10pID0+IHZvaWQ7XG4gIGFkZENoYXRTZXNzaW9uOiAoc2Vzc2lvbjogQ2hhdFNlc3Npb24pID0+IHZvaWQ7XG4gIHVwZGF0ZUNoYXRTZXNzaW9uOiAoc2Vzc2lvbklkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8Q2hhdFNlc3Npb24+KSA9PiB2b2lkO1xuICBkZWxldGVDaGF0U2Vzc2lvbjogKHNlc3Npb25JZDogc3RyaW5nKSA9PiB2b2lkO1xuICBcbiAgLy8g44Oh44OD44K744O844K4566h55CGXG4gIGFkZE1lc3NhZ2U6IChtZXNzYWdlOiBDaGF0TWVzc2FnZSkgPT4gdm9pZDtcbiAgY2xlYXJDdXJyZW50TWVzc2FnZXM6ICgpID0+IHZvaWQ7XG4gIFxuICAvLyDlsaXmrbTjga7kv53lrZgv6Kqt44G/6L6844G/XG4gIHNhdmVDaGF0SGlzdG9yeTogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgbG9hZENoYXRIaXN0b3J5OiAodXNlcklkOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG59XG5cbmV4cG9ydCBjb25zdCB1c2VDaGF0U3RvcmUgPSBjcmVhdGU8Q2hhdFN0b3JlPigoc2V0LCBnZXQpID0+ICh7XG4gIC8vIOODh+ODleOCqeODq+ODiOioreWumjog5bGl5q205L+d5a2Y44Gv54Sh5Yq5XG4gIHNhdmVIaXN0b3J5OiBmYWxzZSxcbiAgc2V0U2F2ZUhpc3Rvcnk6IChzYXZlKSA9PiBzZXQoeyBzYXZlSGlzdG9yeTogc2F2ZSB9KSxcbiAgXG4gIGN1cnJlbnRTZXNzaW9uOiBudWxsLFxuICBzZXRDdXJyZW50U2Vzc2lvbjogKHNlc3Npb24pID0+IHNldCh7IGN1cnJlbnRTZXNzaW9uOiBzZXNzaW9uIH0pLFxuICBcbiAgY2hhdFNlc3Npb25zOiBbXSxcbiAgc2V0Q2hhdFNlc3Npb25zOiAoc2Vzc2lvbnMpID0+IHNldCh7IGNoYXRTZXNzaW9uczogc2Vzc2lvbnMgfSksXG4gIFxuICBhZGRDaGF0U2Vzc2lvbjogKHNlc3Npb24pID0+IHNldCgoc3RhdGUpID0+ICh7XG4gICAgY2hhdFNlc3Npb25zOiBbc2Vzc2lvbiwgLi4uc3RhdGUuY2hhdFNlc3Npb25zXVxuICB9KSksXG4gIFxuICB1cGRhdGVDaGF0U2Vzc2lvbjogKHNlc3Npb25JZCwgdXBkYXRlcykgPT4gc2V0KChzdGF0ZSkgPT4gKHtcbiAgICBjaGF0U2Vzc2lvbnM6IHN0YXRlLmNoYXRTZXNzaW9ucy5tYXAoc2Vzc2lvbiA9PlxuICAgICAgc2Vzc2lvbi5pZCA9PT0gc2Vzc2lvbklkID8geyAuLi5zZXNzaW9uLCAuLi51cGRhdGVzIH0gOiBzZXNzaW9uXG4gICAgKSxcbiAgICBjdXJyZW50U2Vzc2lvbjogc3RhdGUuY3VycmVudFNlc3Npb24/LmlkID09PSBzZXNzaW9uSWQgXG4gICAgICA/IHsgLi4uc3RhdGUuY3VycmVudFNlc3Npb24sIC4uLnVwZGF0ZXMgfVxuICAgICAgOiBzdGF0ZS5jdXJyZW50U2Vzc2lvblxuICB9KSksXG4gIFxuICBkZWxldGVDaGF0U2Vzc2lvbjogKHNlc3Npb25JZCkgPT4gc2V0KChzdGF0ZSkgPT4gKHtcbiAgICBjaGF0U2Vzc2lvbnM6IHN0YXRlLmNoYXRTZXNzaW9ucy5maWx0ZXIoc2Vzc2lvbiA9PiBzZXNzaW9uLmlkICE9PSBzZXNzaW9uSWQpLFxuICAgIGN1cnJlbnRTZXNzaW9uOiBzdGF0ZS5jdXJyZW50U2Vzc2lvbj8uaWQgPT09IHNlc3Npb25JZCA/IG51bGwgOiBzdGF0ZS5jdXJyZW50U2Vzc2lvblxuICB9KSksXG4gIFxuICBhZGRNZXNzYWdlOiAobWVzc2FnZSkgPT4gc2V0KChzdGF0ZSkgPT4ge1xuICAgIGlmICghc3RhdGUuY3VycmVudFNlc3Npb24pIHJldHVybiBzdGF0ZTtcbiAgICBcbiAgICBjb25zdCB1cGRhdGVkU2Vzc2lvbiA9IHtcbiAgICAgIC4uLnN0YXRlLmN1cnJlbnRTZXNzaW9uLFxuICAgICAgbWVzc2FnZXM6IFsuLi5zdGF0ZS5jdXJyZW50U2Vzc2lvbi5tZXNzYWdlcywgbWVzc2FnZV0sXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBjdXJyZW50U2Vzc2lvbjogdXBkYXRlZFNlc3Npb24sXG4gICAgICBjaGF0U2Vzc2lvbnM6IHN0YXRlLmNoYXRTZXNzaW9ucy5tYXAoc2Vzc2lvbiA9PlxuICAgICAgICBzZXNzaW9uLmlkID09PSB1cGRhdGVkU2Vzc2lvbi5pZCA/IHVwZGF0ZWRTZXNzaW9uIDogc2Vzc2lvblxuICAgICAgKVxuICAgIH07XG4gIH0pLFxuICBcbiAgY2xlYXJDdXJyZW50TWVzc2FnZXM6ICgpID0+IHNldCgoc3RhdGUpID0+ICh7XG4gICAgY3VycmVudFNlc3Npb246IHN0YXRlLmN1cnJlbnRTZXNzaW9uID8ge1xuICAgICAgLi4uc3RhdGUuY3VycmVudFNlc3Npb24sXG4gICAgICBtZXNzYWdlczogW11cbiAgICB9IDogbnVsbFxuICB9KSksXG4gIFxuICAvLyBEeW5hbW9EQuOBuOOBruS/neWtmO+8iOWun+ijheaZguOBq0FQSeWRvOOBs+WHuuOBl+OBq+e9ruOBjeaPm+OBiO+8iVxuICBzYXZlQ2hhdEhpc3Rvcnk6IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7IGN1cnJlbnRTZXNzaW9uLCBzYXZlSGlzdG9yeSB9ID0gZ2V0KCk7XG4gICAgaWYgKCFzYXZlSGlzdG9yeSB8fCAhY3VycmVudFNlc3Npb24pIHJldHVybjtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gVE9ETzogRHluYW1vRELjgbjjga7kv53lrZhBUEnlkbzjgbPlh7rjgZdcbiAgICAgIGNvbnNvbGUubG9nKCdTYXZpbmcgY2hhdCBoaXN0b3J5IHRvIER5bmFtb0RCOicsIGN1cnJlbnRTZXNzaW9uKTtcbiAgICAgIFxuICAgICAgLy8g5a6f6Zqb44Gu5a6f6KOF44Gn44Gv5Lul5LiL44Gu44KI44GG44GqQVBJ5ZG844Gz5Ye644GX44Gr44Gq44KK44G+44GZ77yaXG4gICAgICAvLyBhd2FpdCBmZXRjaCgnL2FwaS9jaGF0L3NhdmUnLCB7XG4gICAgICAvLyAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgLy8gICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgIC8vICAgYm9keTogSlNPTi5zdHJpbmdpZnkoY3VycmVudFNlc3Npb24pXG4gICAgICAvLyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgY2hhdCBoaXN0b3J5OicsIGVycm9yKTtcbiAgICB9XG4gIH0sXG4gIFxuICAvLyBEeW5hbW9EQuOBi+OCieOBruiqreOBv+i+vOOBv++8iOWun+ijheaZguOBq0FQSeWRvOOBs+WHuuOBl+OBq+e9ruOBjeaPm+OBiO+8iVxuICBsb2FkQ2hhdEhpc3Rvcnk6IGFzeW5jICh1c2VySWQ6IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IHsgc2F2ZUhpc3RvcnkgfSA9IGdldCgpO1xuICAgIGlmICghc2F2ZUhpc3RvcnkpIHJldHVybjtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gVE9ETzogRHluYW1vRELjgYvjgonjga7oqq3jgb/ovrzjgb9BUEnlkbzjgbPlh7rjgZdcbiAgICAgIGNvbnNvbGUubG9nKCdMb2FkaW5nIGNoYXQgaGlzdG9yeSBmcm9tIER5bmFtb0RCIGZvciB1c2VyOicsIHVzZXJJZCk7XG4gICAgICBcbiAgICAgIC8vIOWun+mam+OBruWun+ijheOBp+OBr+S7peS4i+OBruOCiOOBhuOBqkFQSeWRvOOBs+WHuuOBl+OBq+OBquOCiuOBvuOBme+8mlxuICAgICAgLy8gY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgL2FwaS9jaGF0L2hpc3RvcnkvJHt1c2VySWR9YCk7XG4gICAgICAvLyBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIC8vIHNldCh7IGNoYXRTZXNzaW9uczogc2Vzc2lvbnMgfSk7XG4gICAgICBcbiAgICAgIC8vIOePvuWcqOOBr+ODreODvOOCq+ODq+OCueODiOODrOODvOOCuOOBi+OCieiqreOBv+i+vOOBv++8iOODh+ODoueUqO+8iVxuICAgICAgY29uc3Qgc2F2ZWRTZXNzaW9ucyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGBjaGF0SGlzdG9yeV8ke3VzZXJJZH1gKTtcbiAgICAgIGlmIChzYXZlZFNlc3Npb25zKSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb25zID0gSlNPTi5wYXJzZShzYXZlZFNlc3Npb25zKS5tYXAoKHNlc3Npb246IGFueSkgPT4gKHtcbiAgICAgICAgICAuLi5zZXNzaW9uLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoc2Vzc2lvbi5jcmVhdGVkQXQpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoc2Vzc2lvbi51cGRhdGVkQXQpLFxuICAgICAgICAgIG1lc3NhZ2VzOiBzZXNzaW9uLm1lc3NhZ2VzLm1hcCgobXNnOiBhbnkpID0+ICh7XG4gICAgICAgICAgICAuLi5tc2csXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKG1zZy50aW1lc3RhbXApXG4gICAgICAgICAgfSkpXG4gICAgICAgIH0pKTtcbiAgICAgICAgc2V0KHsgY2hhdFNlc3Npb25zOiBzZXNzaW9ucyB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgY2hhdCBoaXN0b3J5OicsIGVycm9yKTtcbiAgICB9XG4gIH1cbn0pKTsiXX0=